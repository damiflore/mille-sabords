{
  "version": 3,
  "file": "app_loader.js",
  "sources": [
    "../../src/app_loader/app_loader_utils.js",
    "../../src/app_loader/app_loader.js"
  ],
  "sourcesContent": [
    "export const loadCSSAndFonts = async (\n  cssUrl,\n  { timeout = 1000, onCssReady = () => {}, onFontsReady = () => {} } = {},\n) => {\n  const loadedPromise = (async () => {\n    try {\n      await injectCSS(cssUrl)\n      onCssReady()\n      if (onFontsReady) {\n        await document.fonts.ready\n        onFontsReady()\n      }\n    } catch (e) {\n      return\n    }\n  })()\n  return Promise.race([\n    loadedPromise,\n    new Promise((resolve) => {\n      setTimeout(resolve, timeout)\n    }),\n  ])\n}\n\nconst injectCSS = (cssUrl, { crossOrigin } = {}) => {\n  return new Promise((resolve, reject) => {\n    const link = document.createElement(\"link\")\n    link.rel = \"stylesheet\"\n    link.onload = resolve\n    link.onerror = reject\n    link.href = cssUrl\n    link.crossOrigin = crossOrigin\n    document.head.appendChild(link)\n  })\n}\n\nexport const nextIDLEPromise = window.requestIdleCallback\n  ? ({ timeout = 60 } = {}) => {\n      return new Promise((resolve) => {\n        window.requestIdleCallback(resolve, { timeout })\n      })\n    }\n  : () => {\n      return new Promise((resolve) => {\n        window.requestAnimationFrame(resolve)\n      })\n    }\n",
    "import { DEV } from \"#env\"\nimport { loadCSSAndFonts, nextIDLEPromise } from \"./app_loader_utils.js\"\n\nexport const loadApp = async ({ updateSplashscreenText }) => {\n  if (DEV) {\n    performance.measure(`loading app`)\n  }\n\n  // try to load CSS + get the main fonts before displaying any text\n  // to avoid font swapping if possible\n  // give max 400ms for this\n  const appLoaderCssPromise = loadCSSAndFonts(\n    new URL(\"./app_loader.css\", import.meta.url),\n    {\n      timeout: 400,\n      onCssReady: () => {\n        if (DEV) {\n          performance.measure(`app_loader.css ready`)\n        }\n      },\n      onFontsReady: () => {\n        if (DEV) {\n          performance.measure(`fonts ready`)\n        }\n      },\n    },\n  )\n  // start importing app right away\n  const appPromise = importApp({\n    onJsReady: () => {\n      if (DEV) {\n        performance.measure(\"app.js ready\")\n      }\n    },\n  })\n  const appCSSPromise = loadCSSAndFonts(\n    new URL(\"../app/app.css\", import.meta.url),\n    {\n      onCssReady: () => {\n        if (DEV) {\n          performance.measure(`app.css ready`)\n        }\n      },\n    },\n  )\n\n  await appLoaderCssPromise\n  const app = await appPromise\n  if (DEV) {\n    performance.measure(`rendering app`)\n  }\n  await app.createMilleSabordGame({\n    into: document.querySelector(\"#app\"),\n    onLoadProgress: ({ loadedCount, total }) => {\n      updateSplashscreenText(`\n  Chargement du jeu...\n  <div>${loadedCount}/${total}</div>\n`)\n    },\n  })\n  await appCSSPromise\n  // app.render() can be very expensive so we wait a bit\n  // to let navigator an opportunity to cooldown\n  // This should help to save battery power and RAM\n  await nextIDLEPromise()\n  if (DEV) {\n    performance.measure(`app rendered`)\n  }\n}\n\nconst importApp = async ({ onJsReady = () => {} }) => {\n  const app = await import(\"../app/app.jsx\")\n  onJsReady()\n  return app\n}\n"
  ],
  "names": [
    "loadCSSAndFonts",
    "async",
    "cssUrl",
    "timeout",
    "onCssReady",
    "onFontsReady",
    "loadedPromise",
    "injectCSS",
    "document",
    "fonts",
    "ready",
    "e",
    "Promise",
    "race",
    "resolve",
    "setTimeout",
    "crossOrigin",
    "reject",
    "link",
    "createElement",
    "rel",
    "onload",
    "onerror",
    "href",
    "head",
    "appendChild",
    "nextIDLEPromise",
    "window",
    "requestIdleCallback",
    "requestAnimationFrame",
    "importApp",
    "updateSplashscreenText",
    "appLoaderCssPromise",
    "appPromise",
    "onJsReady",
    "appCSSPromise",
    "app",
    "createMilleSabordGame",
    "into",
    "querySelector",
    "onLoadProgress",
    "_ref2",
    "loadedCount",
    "total",
    "module"
  ],
  "mappings": "yEAAO,MAAMA,EAAkBC,eAC7BC,OACAC,QAAEA,EAAU,IAAZC,WAAkBA,EAAa,SAA/BC,aAAyCA,EAAe,iEAAa,SAE/DC,EAAgB,qBAEZC,EAAUL,GAChBE,IACIC,UACIG,SAASC,MAAMC,MACrBL,KAEF,MAAOM,YARW,UAYfC,QAAQC,KAAK,CAClBP,EACA,IAAIM,SAASE,IACXC,WAAWD,EAASX,SAKpBI,EAAY,SAACL,OAAQc,YAAEA,0DAAgB,UACpC,IAAIJ,SAAQ,CAACE,EAASG,WACrBC,EAAOV,SAASW,cAAc,QACpCD,EAAKE,IAAM,aACXF,EAAKG,OAASP,EACdI,EAAKI,QAAUL,EACfC,EAAKK,KAAOrB,EACZgB,EAAKF,YAAcA,EACnBR,SAASgB,KAAKC,YAAYP,OAIjBQ,EAAkBC,OAAOC,oBAClC,eAACzB,QAAEA,EAAU,2DAAO,UACX,IAAIS,SAASE,IAClBa,OAAOC,oBAAoBd,EAAS,CAAEX,QAAAA,QAG1C,IACS,IAAIS,SAASE,IAClBa,OAAOE,sBAAsBf,MC0B/BgB,gBAnEiB7B,MAAAA,QAAO8B,uBAAEA,WAQxBC,EAAsBhC,EAC1B,8DACA,CACEG,QAAS,IACTC,WAAY,OAKZC,aAAc,SAQZ4B,EAAaH,EAAU,CAC3BI,UAAW,SAMPC,EAAgBnC,EACpB,uDACA,CACEI,WAAY,eAQV4B,QACAI,QAAYH,QAIZG,EAAIC,sBAAsB,CAC9BC,KAAM9B,SAAS+B,cAAc,QAC7BC,eAAgBC,QAACC,YAAEA,EAAFC,MAAeA,KAC9BZ,EAAwB,oCAErBW,KAAeC,sBAIhBR,QAIAT,OAMUzB,MAAAA,QAAOiC,UAAEA,EAAY,kBAC/BE,QAAYQ,SAAO,oDACzBV,IACOE"
}