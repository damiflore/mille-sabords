System.register([__v__("/mille-sabords/js/vendors.nomodule.js"),__v__("/mille-sabords/js/app.nomodule.js")],(function(e,t){"use strict";var r,n,o,l,s,a,c,i,d,u,m,h,f,p,g,v,b,y,C,N,k,S,x,D,w,R,A,I,O,E,L,M,P,q,T,j,U,B,$,F,G,_,z,W,Y,H,K,V,Z,X,J,Q,ee,te,re,ne,oe,le,se,ae,ce,ie,de,ue,me,he,fe,pe,ge,ve,be,ye,Ce,Ne,ke,Se,xe,De,we,Re,Ae,Ie,Oe,Ee,Le,Me,Pe,qe,Te,je,Ue,Be,$e,Fe,Ge,_e,ze,We,Ye,He,Ke,Ve,Ze,Xe,Je,Qe,et,tt,rt,nt,ot,lt,st,at,ct,it,dt,ut,mt,ht,ft,pt,gt,vt,bt,yt,Ct,Nt,kt,St,xt,Dt,wt,Rt,At,It,Ot,Et,Lt,Mt,Pt,qt,Tt,jt,Ut,Bt,$t,Ft,Gt,_t,zt,Wt,Yt,Ht,Kt,Vt,Zt,Xt,Jt,Qt,er,tr,rr,nr,or,lr,sr,ar,cr,ir,dr,ur,mr,hr,fr,pr,gr,vr,br,yr,Cr,Nr,kr,Sr,xr,Dr,wr,Rr,Ar,Ir,Or,Er,Lr,Mr,Pr,qr,Tr,jr,Ur,Br,$r,Fr,Gr,_r,zr,Wr,Yr,Hr,Kr,Vr,Zr,Xr,Jr,Qr,en,tn,rn,nn,on,ln,sn,an,cn,dn,un,mn,hn,fn,pn,gn,vn,bn,yn,Cn,Nn,kn,Sn,xn,Dn,wn,Rn,An,In,On,En,Ln,Mn,Pn,qn,Tn,jn,Un,Bn,$n,Fn,Gn,_n,zn,Wn,Yn,Hn,Kn,Vn,Zn,Xn,Jn,Qn,eo,to,ro,no,oo,lo,so,ao,co,io,uo,mo,ho,fo,po,go,vo,bo,yo,Co,No,ko,So,xo,Do,wo,Ro,Ao,Io,Oo,Eo,Lo,Mo,Po,qo,To,jo,Uo,Bo,$o,Fo,Go,_o,zo,Wo,Yo,Ho,Ko,Vo,Zo,Xo,Jo,Qo,el,tl,rl,nl,ol,ll,sl,al,cl,il,dl,ul,ml,hl,fl,pl,gl,vl,bl,yl,Cl,Nl,kl,Sl,xl,Dl,wl,Rl,Al,Il,Ol,El,Ll,Ml,Pl,ql,Tl,jl,Ul,Bl,$l,Fl,Gl,_l,zl,Wl,Yl,Hl,Kl,Vl,Zl,Xl,Jl,Ql,es,ts,rs,ns,os,ls,ss,as,cs,is,ds,us;return{setters:[function(e){r=e.__jsenv_default_import__,n=e.jsx,o=e._objectSpread2,l=e._objectWithoutProperties,s=e.jsxs,a=e.__jsenv_default_import__$1,c=e.Fragment,i=e.createLogger,d=e.addToHomescreen},function(e){u=e.loadImage,m=e.useUrlLoadingNotifier,h=e.symbolSwordUrl,f=e.createAction,p=e.diceToVisibleSymbol,g=e.isSwordChallengeCard,v=e.isAnimalsCard,b=e.SYMBOL_PARROT,y=e.SYMBOL_MONKEY,C=e.isPirateCard,N=e.isCoinCard,k=e.isDiamondCard,S=e.SYMBOL_DIAMOND,x=e.SYMBOL_COIN,D=e.SYMBOL_SWORD,w=e.useCurrentPlayerId,R=e.usePlayers,A=e.useCardIds,I=e.cardIdToCard,O=e.useRollCount,E=e.useDices,L=e.useChestSlots,M=e.useDiceRolledIds,P=e.useWitchUncursedDiceId,q=e.diceIsOnSkull,T=e.useDiceCursedIds,j=e.symbolIsSkull,U=e.useCurrentCardId,B=e.isOneSkullCard,$=e.SYMBOL_SKULL,F=e.isTwoSkullsCard,G=e.useScoreMarked,_=e.isChestCard,z=e.useAnimationsDisabled,W=e.useIsOnSkullIsland,Y=e.mixDeck,H=e.useCurrentCardActivated,K=e.addLoadedListener,V=e.isFocusable,Z=e.getStyleValue,X=e.isDocumentElement,J=e.useMainDomNode,Q=e.symbolCoinUrl,ee=e.symbolDiamondUrl,te=e.getDocumentScroll,re=e.symbolToImageUrl,ne=e.SYMBOLS,oe=e.symbolIsMonkey,le=e.symbolIsParrot,se=e.symbolIsCoin,ae=e.symbolIsDiamond,ce=e.cardToImageUrl,ie=e.cardToSmallImageUrl,de=e.cardDefaultUrl,ue=e.symbolSkullUrl,me=e.isWitchCard,he=e.addDomEventListener,fe=e.useDiceDomNode,pe=e.useDiceDomNodeSetter,ge=e.useWitchCardEffectUsed,ve=e.useRoundStarted,be=e.CARD_TWO_SWORDS_CHALLENGE,ye=e.useGameStarted,Ce=e.defaultState,Ne=e.swFacade,ke=e.useSoundDisabled,Se=e.symbolMonkeyUrl,xe=e.useMainDomNodeSetter,De=e.useGameCreated}],execute:function(){we=new Map,Re={LOADING:"loading",LOADED:"loaded",FAILED:"failed"},Ae=function(e){let{lazy:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=we.get(e)?Re.LOADED:Re.LOADING,[o,l]=r.useState(n),s=r.useRef(!1);r.useEffect((()=>(s.current=!0,()=>{s.current=!1})),[]);const a=r.useCallback((async()=>{if(o!==Re.LOADED)try{const t=await u(e);if(!s.current)return void console.log("image unmounted");we.set(e,t),l(Re.LOADED)}catch(t){if(!s.current)return;we.delete(e),l(Re.FAILED)}}),[l,e]);return r.useEffect((()=>{t||a()}),[t]),[o,a]},Ie=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],{layout:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=r.useRef(!0);(n?r.useLayoutEffect:r.useEffect)((()=>{if(!o.current)return e();o.current=!1}),t)},Oe=(e,t)=>{const r=Ee(e,t);return Boolean(r)},Ee=(e,t)=>{const n=r.useRef(!1);r.useEffect((()=>{!1===n.current&&(n.current=!0)}));const o=r.useRef(t);return r.useEffect((()=>{o.current=t}),t),n.current&&e(...o.current)?{from:o.current,to:t}:null},Le=e=>{const t=r.useRef(e);return r.useEffect((()=>{t.current=e}),[e]),t.current},Me=e=>{let{root:t,rootMargin:n,threshold:o=0}=e;const[l,s]=r.useState(!1),a=r.useRef();return r.useEffect((()=>{const e=a.current;if(!e)return;if(l)return;const r=new window.IntersectionObserver((t=>{let[n]=t;n.isIntersecting?(r.unobserve(e),s(!0)):s(!1)}),{root:t,rootMargin:n,threshold:o});return r.observe(e),()=>{r.disconnect()}}),[l]),[a,l]},Pe=["loadWhenIntersecting","usePlaceholderWhileLoading","animateLoaded","intersectionRoot","intersectionRootMargin","intersectionThreshold","FallbackWhileNotIntersecting","FallbackWhileLoading","useImageStatusHook","src"],qe=e=>{let{loadWhenIntersecting:t=!0,usePlaceholderWhileLoading:s=!0,animateLoaded:a=!0,intersectionRoot:c,intersectionRootMargin:i,intersectionThreshold:d,FallbackWhileNotIntersecting:u=Ue,FallbackWhileLoading:h=je,useImageStatusHook:f=Ae,src:p}=e,g=l(e,Pe);const[v,b]=f(p,{lazy:t}),y=Le(v),[C,N]=m(p);r.useEffect((()=>{"loading"!==y&&"loading"===v&&C(),"loaded"!==y&&"loaded"===v&&N()}),[y,v]);const[k,S]=Me({root:c,rootMargin:i,threshold:d}),x=Le(S);r.useEffect((()=>{t&&!x&&S&&b()}),[t,x,S]);const[D,w]=Te();return r.useLayoutEffect((()=>{a&&"loaded"!==y&&"loaded"===v&&w()}),[a,y,v]),t&&"loaded"!==v&&!S?n(u,{ref:k}):s&&"loaded"!==v?n(h,{}):n("img",o({src:p,ref:D},g))},Te=()=>{const e=r.useRef(),t=r.useCallback((()=>{const t=e.current,r=window.getComputedStyle(t).getPropertyValue("opacity");t.animate([{opacity:0},{opacity:r}],{duration:300})}));return[e,t]},je=r.forwardRef(((e,t)=>n("img",o({src:Be,ref:t},e)))),Ue=r.forwardRef(((e,t)=>n("img",o({src:Be,ref:t},e)))),Be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",$e=()=>n(Fe,{}),Fe=()=>{const e=Ge();return s("div",{className:"new-game",children:[n(qe,{src:h}),n("button",{onClick:e,children:"Nouvelle partie"})]})},Ge=f((e=>o(o({},e),{},{gameCreated:!0}))),_e=(e,t)=>{if(e&&"symbol"===e.type)return e.value;if(e&&"dice"===e.type){const r=t[e.value];return p(r)}return null},ze=e=>{let{card:t,symbolsInChest:r,scoreMarked:n,markScoreAllowed:o}=e;return g(t)?n||o?We(r,{goal:t.numberOfSwords,gamble:t.gambleAmount}):-t.gambleAmount:v(t)?He(r.map((e=>e===b?y:e))):C(t)?2*He(r):N(t)||k(t)?He(r,9):He(r)},We=(e,t)=>{let{goal:r,gamble:n}=t;return Ye(e,D)>=r?He(e)+n:-n},Ye=(e,t)=>e.filter((e=>e===t)).length,He=(e,t)=>{const{score:r,perfectBonus:n}=Ke(e,t);return r+n},Ke=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,r=0,n=0;const o=Ve(e);return Object.values(o).forEach((e=>{3===e&&(r+=100),4===e&&(r+=200),5===e&&(r+=500),6===e&&(r+=1e3),7===e&&(r+=2e3),8===e&&(r+=4e3),e>2&&(n+=e)})),e.forEach((e=>{e===S&&(r+=100,o[S]<3&&(n+=1)),e===x&&(r+=100,o[x]<3&&(n+=1))})),{score:r,perfectBonus:n===t?500:0}},Ve=e=>{const t={};return e.forEach((e=>{t.hasOwnProperty(e)?t[e]++:t[e]=1})),t},({useMemo:Ze}=r),Xe=function(){let{cardIds:e=A()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.map((e=>I(e)))},Je=function(){let{currentPlayerId:e=w(),players:t=R()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.find((t=>t.id===e))},Qe=function(){let{rollCount:e=O()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return 0===e},et=function(){let{rollCount:e=O()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e>0},tt=function(){let{rollCount:e=O()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return 1===e},rt=function(){let{dices:e=E(),chestSlots:t=L()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(t).reduce(((r,n)=>{const o=_e(t[n],e);return o?[...r,o]:r}),[])},nt=function(){let{skullCountInCursedArea:e=ut()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return 3-e},ot=function(){let{dicesToCurse:e=st()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.length>0},lt=function(){let{chestSlots:e=L()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).reduce(((t,r)=>{const n=e[r];return n&&"dice"===n.type?[...t,n.value]:t}),[])},st=function(){let{dices:e=E(),diceRolledIds:t=M(),witchUncursedDiceId:r=P(),remainingSpotInCursedArea:n=nt()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.map((t=>e[t])).filter((e=>!!q(e)&&e.id!==r)).slice(0,n)},at=function(){let{currentCardId:e=U(),hasNeverRolled:t=Qe(),scoreMarked:r=G(),threeSkullsOrMoreInCursedArea:n=dt(),hasDicesToCurse:o=ot()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!!e&&(!r&&(!!t||(n?!!_(I(e)):!o)))},ct=function(){let{dicesToCurse:e=st(),skullCountInCursedArea:t=ut()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.length+t},it=function(){let{cursedCount:e=ct()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e>2},dt=function(){let{skullCountInCursedArea:e=ut()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e>2},ut=function(){let{diceCursedIds:e=T(),symbolsFromCard:t=mt()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.length+t.filter((e=>j(e))).length},mt=function(){let{currentCardId:e=U()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e)return[];const t=I(e);return N(t)?[x]:k(t)?[S]:B(t)?[$]:F(t)?[$,$]:[]},ht=function(){let{hasRolledOnce:e=et(),scoreMarked:t=G(),currentCardId:r=U(),hasDicesToCurse:n=ot()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!t&&(!n&&(!!r&&!!e))},ft=function(){let{scoreMarked:e=G(),currentCardId:t=U(),threeSkullsOrMoreInCursedArea:r=dt(),hasDicesToCurse:n=ot()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!e&&(r?!!_(I(t)):!n&&!!t)},pt=function(){let{rollDiceAllowed:e=at(),markScoreAllowed:t=ft(),hasDicesToCurse:r=ot()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!e&&(!t&&!r)},gt=function(){let{currentCardId:e=U(),symbolsInChest:t=rt(),scoreMarked:r=G(),markScoreAllowed:n=ft()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Ze((()=>ze({card:I(e),symbolsInChest:t,scoreMarked:r,markScoreAllowed:n})),[e,t,r,n])},vt=()=>{const e=U(),t=I(e),r=rt(),n=Ye(r,D),o=bt();return!!g(t)&&n<o},bt=function(){let{currentCardId:e=U()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=I(e);return g(t)?t.numberOfSwords:null},yt=f(((e,t)=>o(o({},e),{},{currentPlayerId:t.id,currentCardId:null,currentCardActivated:!1,roundStarted:!0},xt))),Ct=f((e=>o(o({},e),{},{currentCardId:null,currentCardActivated:!1,roundStarted:!1}))),Nt=f((e=>o(o({},e),{},{currentCardActivated:!0}))),kt=f((e=>o(o({},e),{},{isOnSkullIsland:!0}))),St=f(((e,t)=>{const{players:r,currentPlayerId:n}=e,l=r.find((e=>{let{id:t}=e;return t===n})),s=l.score+t;return l.score=s<0?0:s,o(o({},e),{},{players:[...r],scoreMarked:!0})})),xt={witchUncursedDiceId:null,witchCardEffectUsed:!1,rollCount:0,diceRolledIds:[],diceCursedIds:[],chestSlots:{1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null,9:null},scoreMarked:!1,isOnSkullIsland:!1},Dt=f(((e,t,r,n)=>{let{x:l,y:s}=r;const{dices:a}=e;return t.rolledAreaPosition={x:l,y:s},t.rolledAreaZIndex=n,o(o({},e),{},{dices:o({},a)})})),wt=f(((e,t,r)=>{const{chestSlots:n}=e,l=Object.keys(n).find((e=>{const r=n[e];return r&&"dice"===r.type&&r.value===t.id}));return o(o({},e),{},{chestSlots:o(o(o({},n),l?{[l]:null}:{}),{},{[r]:{type:"dice",value:t.id}})})})),Rt=f(((e,t)=>{const{diceRolledIds:r,diceCursedIds:n}=e;return o(o({},e),{},{diceRolledIds:r.filter((e=>e!==t.id)),diceCursedIds:[...n,t.id]})})),At=f((function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{diceRolledIds:n,diceCursedIds:l}=e;return o(o(o({},e),r?{}:{witchUncursedDiceId:t.id,witchCardEffectUsed:!0}),{},{diceRolledIds:[...n,t.id],diceCursedIds:l.filter((e=>e!==t.id))})})),It=f(((e,t)=>{const{diceRolledIds:r,chestSlots:n}=e,l=Object.keys(n).find((e=>{const r=n[e];return r&&"dice"===r.type&&r.value===t.id}));return o(o({},e),{},{diceRolledIds:[...r,t.id],chestSlots:o(o({},n),{},{[l]:null})})})),Ot=f(((e,t,r)=>{const{diceRolledIds:n,chestSlots:l}=e;return o(o({},e),{},{diceRolledIds:n.filter((e=>e!==t.id)),chestSlots:o(o({},l),{},{[r]:{type:"dice",value:t.id}})})})),({useEffect:Et}=r),Lt=()=>(Mt(),null),Mt=()=>{Pt(),qt(),Tt()},Pt=()=>{const e=z(),t=st(),r=Rt();Et((()=>{if(0===t.length)return()=>{};if(e)return t.forEach((e=>{r(e)})),()=>{};const n=setTimeout((()=>{t.forEach((e=>{r(e)}))}),1e3);return()=>{clearTimeout(n)}}),[t])},qt=()=>{const e=I(U()),t=G(),r=St(),n=dt(),o=Oe((e=>!e&&n),[n]),l=gt(),s=g(e);Et((()=>{s&&!t&&o&&r(l)}),[s,t,o,l])},Tt=()=>{const e=tt(),t=I(U()),r=W(),n=ut(),o=kt();Et((()=>{e&&(r||g(t)||n<4||o())}),[e,r,t,n])},jt=f((e=>{const{cardIds:t,cardUsedIds:r}=e,n=t[0];return o(o({},e),{},{cardIds:t.slice(1),cardUsedIds:[...r,n],currentCardId:n})})),Ut=f((e=>{const{chestSlots:t}=e;return o(o({},e),{},{chestSlots:o(o({},t),{},{1:{type:"symbol",value:x}})})})),Bt=f((e=>{const{chestSlots:t}=e;return o(o({},e),{},{chestSlots:o(o({},t),{},{1:{type:"symbol",value:S}})})})),$t=f((e=>{const{cardIds:t,cardUsedIds:r}=e;return o(o({},e),{},{cardIds:Y([...t,...r]),cardUsedIds:[]})})),Ft=()=>(Gt(),_t(),null),Gt=()=>{const e=Ut(),t=U(),n=H(),o=Oe((e=>!e===n),[n]),l=t&&N(I(t));r.useEffect((()=>{l&&e()}),[]),r.useEffect((()=>{o&&l&&e()}),[o,l])},_t=()=>{const e=Bt(),t=U(),n=H(),o=Oe((e=>!e===n),[n]),l=t&&k(I(t));r.useEffect((()=>{l&&e()}),[]),r.useEffect((()=>{o&&l&&e()}),[o,l])},zt=()=>{let e=[];return{listen:function(t){let{once:r=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r){const e=t;t=function(){o(),e(...arguments)}}e=[...e,t];let n=!1;const o=()=>{if(n)return;n=!0;const r=[];let o=e.length,l=!0;for(;o--;){const n=e[o];l&&n===t?l=!1:r.push(n)}e=r};return o},emit:function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];e.forEach((e=>{e(...r)}))}}},Wt=()=>{const[e]=r.useState((()=>zt()));return[e.listen,e.emit]},Yt=e=>{const[t,n]=r.useState();return r.useEffect((()=>e(n)),[]),t},Ht=e=>{let{rolledAreaRef:t,offscreenRef:r,diceOverRolledAreaListener:l}=e;const a=Yt(l);return s("div",{className:"dice-ongoing",children:[n("div",{className:"map"}),n("div",{className:"area",ref:t,style:o({},a?{outline:"2px dotted"}:{})}),n("div",{className:"offscreen-area",ref:r})]})},Kt=e=>{let{duration:t=300,timingFunction:r=(e=>e),onProgress:n=(()=>{}),onCancel:o=(()=>{}),onComplete:l=(()=>{})}=e;if(isNaN(t))return console.warn(`duration must be a number, received ${t}`),()=>{};t=parseInt(t,10);const s=performance.now();let a,c=!1,i=0,d=0;const u=()=>{a=null;const e=performance.now();i=Math.min((e-s)/t,1),d=r(i),c=1===i,n({done:c,rawProgress:i,progress:d}),c?l():a=window.requestAnimationFrame(u)};u();return()=>{a&&(window.cancelAnimationFrame(a),a=null),c||(c=!0,o({rawProgress:i,progress:d}))}},Vt=function(e){let{duration:t=300,timingFunction:n,condition:o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[l,s]=r.useState(null);return Zt(e,((e,r)=>(s({value:e}),Kt({duration:t,timingFunction:n,onProgress:t=>{let{progress:n}=t;const o=Math.round(e+(r-e)*n);s({value:o})},onComplete:()=>{s(null)}}))),{condition:o}),l},Zt=function(e,t){let{condition:n=(()=>!0)}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const[o,l]=r.useState(null),s=Le(e);r.useEffect((()=>{s!==e&&n(e,s)&&l({from:s,to:e})}),[s,e]),r.useEffect((()=>o?t(o.from,o.to):()=>{}),[o])},Xt=e=>{let{value:t,duration:r,condition:n}=e;const o=Vt(t,{duration:r,condition:n});return o?o.value:t},Jt=["useCount"],Qt=["useCount"],er=e=>{let{href:t,onLoad:n=(()=>{})}=e;const[o,l]=m(t);return r.useEffect((()=>(o(),rr(t,{onload:()=>{l(),n()}}))),[t]),null},tr=e=>{const t=new Map,r=e=>{if(!t.has(e))return;const r=t.get(e),{useCount:n}=r,s=l(r,Jt);n>1?t.set(e,o({useCount:n-1},s)):(t.delete(e),s.linkCleanup())};return function(n){if(t.has(n)){const e=t.get(n),{useCount:s}=e,a=l(e,Qt);return t.set(n,o({useCount:s+1},a)),r}for(var s=arguments.length,a=new Array(s>1?s-1:0),c=1;c<s;c++)a[c-1]=arguments[c];const i=e(n,...a);return t.set(n,{useCount:1,linkCleanup:i}),r}},rr=tr((function(e){let{onload:t=(()=>{})}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=document.createElement("link");r.rel="stylesheet",r.type="text/css";const n=K(r,t);return r.href=e,document.head.appendChild(r),()=>{n(),document.head.removeChild(r)}})),nr=(e,t)=>{const r=cr(e,e);let{done:n,value:o}=r.next();for(;!1===n;){if(t(o))return o;({done:n,value:o}=r.next())}return null},or=(e,t)=>{const r=dr(e);if(r){const n=mr(r,e);let{done:o,value:l}=n.next();for(;!1===o;){if(t(l))return l;({done:o,value:l}=n.next())}}return null},lr=e=>{let{from:t,root:r=null,predicate:n,skipChildren:o=!1}=e;const l=ir(t,r,o);let{done:s,value:a}=l.next();for(;!1===s;){if(n(a))return a;({done:s,value:a}=l.next())}return null},sr=e=>{let{from:t,root:r=null,predicate:n}=e;const o=mr(t,r);let{done:l,value:s}=o.next();for(;!1===l;){if(n(s))return s;({done:l,value:s}=o.next())}return null},ar=function e(t,r){if(!(arguments.length>2&&void 0!==arguments[2]&&arguments[2])){const e=t.firstChild;if(e)return e}const n=t.nextSibling;if(n)return n;const o=t.parentNode;return o&&o!==r?e(o,r,!0):null},cr=(e,t)=>{let r=e;return{next:()=>{const e=ar(r,t);return r=e,{done:!1===Boolean(e),value:e}}}},ir=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e,o=!1;return{next:()=>{const e=ar(n,t,r&&!1===o);return o=!0,n=e,{done:!1===Boolean(e),value:e}}}},dr=e=>{let t=e.lastChild;for(;t;){const e=t.lastChild;if(!e)break;t=e}return t},ur=(e,t)=>{const r=e.previousSibling;if(r){const e=dr(r);return e||r}if(e!==t){const r=e.parentNode;if(r&&r!==t)return r}return null},mr=(e,t)=>{let r=e;return{next:()=>{const e=ur(r,t);return r=e,{done:!1===Boolean(e),value:e}}}},hr=e=>{const t=nr(e,V);return t||(V(e)?e:null)},fr=e=>{if(3===e.nodeType)return console.warn("cannot trap focus inside a text node"),()=>{};if(br.find((t=>t.element===e)))return console.warn("focus already trapped inside this element"),()=>{};const t=()=>nr(e,gr),r=()=>or(e,gr),n=n=>{const o=document.activeElement===document.body;if(n.shiftKey){const t=o?r():sr({from:document.activeElement,root:e,predicate:gr})||r();t&&t.focus()}else{const r=o?t():lr({from:document.activeElement,root:e,predicate:gr})||t();r&&r.focus()}},o=yr({element:e,lock:()=>{const t=t=>{(t=>t.target!==e&&!e.contains(t.target))(t)&&(t.preventDefault(),t.stopImmediatePropagation())},r=e=>{vr(e)&&(e.preventDefault(),n(e))};return document.addEventListener("mousedown",t,{capture:!0,passive:!1}),document.addEventListener("keydown",r,{capture:!0,passive:!1}),()=>{document.removeEventListener("mousedown",t,{capture:!0,passive:!1}),document.removeEventListener("keydown",r,{capture:!0,passive:!1})}}});return()=>{o()}},pr=e=>e.hasAttribute&&e.hasAttribute("tabIndex")&&Number(e.getAttribute("tabindex"))<0,gr=e=>!pr(e)&&V(e),vr=e=>"Tab"===e.key||9===e.keyCode,br=[],yr=e=>{let t,{lock:r}=e;br.length>0&&(t=br[br.length-1],t.unlock());const n={lock:r,unlock:r()};return br.push(n),()=>{if(0===br.length)return void console.warn("cannot deactivate an already deactivated trap");const e=br[br.length-1];n===e?(br.pop(),n.unlock(),t&&(t.unlock=t.lock())):console.warn("you must deactivate trap in the same order they were activated")}},Cr=e=>{const t=[];let r=e.previousSibling;for(;r;)1===r.nodeType&&Or(r)&&t.push(r),r=r.previousSibling;const n=Nr(e);t.push(...n);const o=t.map((e=>{const t=e.style.overflow;return e.style.overflow="hidden",()=>{t?e.style.overflow=t:e.style.removeProperty("overflow")}}));return()=>{o.forEach((e=>{e()}))}},Nr=e=>{const t=[],r=e=>{const n=kr(e);if(n){if(t.push(n),n===document)return;r(n)}};return r(e),t},kr=e=>{if("object"!=typeof e||1!==e.nodeType)throw new TypeError("getScrollableParent first argument must be DOM node");const t=e;if(t===document.documentElement)return null;return"fixed"===Z(t,"position")?Sr(t.ownerDocument):Mr(t)||Sr(t.ownerDocument)},Sr=e=>{if("scrollingElement"in e)return e.scrollingElement;if(Ar(e))return e.documentElement;const t=e.body,r=t&&!/body/i.test(t.tagName)?xr(t):t;return r&&wr(r)?null:r},xr=e=>{let t=e;for(;t=t.nextSibling;)if(1===t.nodeType&&Dr(t))return t;return null},Dr=e=>e.ownerDocument.body===e,wr=e=>{if(!Or(e))return!1;if(Rr(e))return!1;const t=e.ownerDocument.documentElement;return!!Or(t)&&!Rr(t)},Rr=e=>{const t=Z(e,"display");return"none"!==t&&("table-row"!==t&&"table-group"!==t&&"table-column"!==t||"collapsed"!==Z(e,"visibility"))},Ar=e=>!!/^CSS1/.test(e.compatMode)&&Ir(e),Ir=e=>{const t=e.createElement("iframe");t.style.height="1px";(e.body||e.documentElement||e).appendChild(t);const r=t.contentWindow.document;r.write('<!DOCTYPE html><div style="height:9999em">x</div>'),r.close();const n=r.documentElement.scrollHeight>r.body.scrollHeight;return t.parentNode.removeChild(t),n},Or=e=>!Er(e)||!Lr(e),Er=e=>{if("visible"===Z(e,"overflow-x"))return!0;return"visible"===Z(e,"overflow")},Lr=e=>{if("visible"===Z(e,"overflow-y"))return!0;return"visible"===Z(e,"overflow")},Mr=e=>{if(e===document.documentElement)return null;const t=Z(e,"position");let r=e.parentNode;for(;r;){if(X(r))return null;if("absolute"!==t||"static"!==Z(r,"position")){if(Or(r))return r;r=r.parentNode}else r=r.parentNode}return null},Pr=["container","insertTop","insertLeft","insertRight","insertBottom","children","isOpen","requestCloseOnEscape","requestCloseOnClickOutside","closeMethod","stealFocus","restoreStolenFocus","trapFocus","onAfterOpen","onRequestClose","onFocusIn","onFocusOut","backdropProps"],qr=["onMouseDownActive"],Tr=new URL(__v__("/mille-sabords/css/dialog.base.css"),t.meta.url),({useEffect:jr}=r),Ur=e=>{let{container:t=document.body,insertTop:c,insertLeft:i,insertRight:d,insertBottom:u,children:m,isOpen:h,requestCloseOnEscape:f=!0,requestCloseOnClickOutside:p=!1,closeMethod:g="display-none",stealFocus:v=!0,restoreStolenFocus:b=!0,trapFocus:y=!0,onAfterOpen:C=(()=>{}),onRequestClose:N=(()=>{}),onFocusIn:k=(()=>{}),onFocusOut:S=(()=>{}),backdropProps:x={}}=e,D=l(e,Pr);if(!t)return null;const[w,R]=r.useState(null),A=Boolean(w);return Oe((e=>!e&&h),[h])&&C(),jr((()=>{if(!h||!A)return()=>{};let e=$r(w);const t=t=>{t.relatedTarget||e&&(e=!1,S(t))},r=t=>{k(t),e=!0},n=t=>{$r(w)?e=!0:(e=!1,S(t))};return w.addEventListener("focus",r,!0),document.addEventListener("focus",n,!0),document.addEventListener("blur",t,!0),()=>{w.removeEventListener("focus",r,!0),document.removeEventListener("focus",n,!0),document.removeEventListener("blur",t,!0)}}),[h,A,k,S]),jr((()=>h&&A?Cr(w):()=>{}),[h,A]),jr((()=>h&&A&&y?fr(w):()=>{}),[h,A,y]),jr((()=>{if(!h||!A||!v)return()=>{};const e=document.activeElement,t=hr(w);return t&&t.focus({preventScroll:!0}),()=>{t&&("function"==typeof b?b(e):!0===b&&e.focus({preventScroll:!0}))}}),[h,A,v]),jr((()=>{if(!h||!w||!w.parentNode)return()=>{};const e=[];return Array.from(w.parentNode.children).forEach((t=>{t!==w&&e.push(t)})),e.forEach((e=>{e.setAttribute("aria-hidden","true")})),()=>{e.forEach((e=>{e.removeAttribute("aria-hidden","true")}))}}),[h,w]),"dom-remove"!==g||h?a.createPortal(s("div",o(o({},D),{},{role:"dialog",className:"dialog--root"+(D.className?` ${D.className}`:""),ref:e=>{R(e),D.ref&&D.ref(e)},onKeyDown:e=>{f&&e.keyCode===Fr&&N(e),D.onKeyDown&&D.onKeyDown(e)},tabIndex:"-1",style:o(o({},"display-none"!==g||h?{}:{display:"none"}),"visibility-hidden"!==g||h?{}:{visibility:"hidden"}),hidden:"hidden-attribute"===g&&!h||void 0,children:[n(er,{href:Tr}),h?n(Br,o(o({},x),{},{className:"dialog--backdrop",onMouseDownActive:e=>{if(e.preventDefault(),!$r(w)){const e=hr(w);e&&e.focus({preventScroll:!0})}},onClick:e=>{p&&N(e),x.onClick&&x.onClick(e)}})):null,s("div",{className:"dialog--document",children:[n("div",{className:"dialog--insert-top",children:c}),s("div",{className:"dialog--main",children:[n("div",{className:"dialog--insert-left",children:i}),n("div",{className:"dialog--scrollable-content",children:m}),n("div",{className:"dialog--insert-right",children:d})]}),n("div",{className:"dialog--insert-bottom",children:u})]})]})),t):null},Br=e=>{let{onMouseDownActive:t}=e,s=l(e,qr);const[a,c]=r.useState(null);return jr((()=>a?(a.addEventListener("mousedown",t,{passive:!1}),()=>{a.removeEventListener("mousedown",t,{passive:!1})}):()=>{}),[a]),n("div",o({ref:e=>{c(e),s.ref&&s.ref(e)}},s))},$r=e=>{const{activeElement:t}=document;return e===t||e.contains(t)},Fr=27,Gr=new URL(__v__("/mille-sabords/css/dialog.css"),t.meta.url),_r=e=>s(c,{children:[n(er,{href:Gr}),n(Ur,o({container:J()},e))]}),zr=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const[t,n]=r.useState(e);return[t,()=>{n(!0)},()=>{n(!1)}]},Wr=()=>s("div",{className:"star-rain-container",children:[n("div",{className:"star",id:"star-01",children:n(Yr,{})}),n("div",{className:"star",id:"star-02",children:n(Yr,{})}),n("div",{className:"star",id:"star-03",children:n(Yr,{})}),n("div",{className:"star",id:"star-04",children:n(Yr,{})}),n("div",{className:"star",id:"star-05",children:n(Yr,{})}),n("div",{className:"star",id:"star-06",children:n(Yr,{})})]}),Yr=()=>n("svg",{viewBox:"0 0 217.791 210.633",children:n("path",{fill:"#FFFFE6",d:"M94.15,77.97c0,0-2-54,10-73.5s23,28.5,25.5,72.5c0,0,69.197,4.589,86.5,21c13.637,12.934-61.5,31-87,33.5 c-2,14.5-1.831,60.464-16.5,75.5c-20,20.5-25.5-50.5-23-78c-19-1.5-81.5-3.5-89-17.5S52.15,85.97,94.15,77.97z"})}),Hr=()=>n("svg",{viewBox:"0 0 320 512",width:"32",height:"32",children:n("path",{fill:"currentColor",d:"M207.6 256l107.72-107.72c6.23-6.23 6.23-16.34 0-22.58l-25.03-25.03c-6.23-6.23-16.34-6.23-22.58 0L160 208.4 52.28 100.68c-6.23-6.23-16.34-6.23-22.58 0L4.68 125.7c-6.23 6.23-6.23 16.34 0 22.58L112.4 256 4.68 363.72c-6.23 6.23-6.23 16.34 0 22.58l25.03 25.03c6.23 6.23 16.34 6.23 22.58 0L160 303.6l107.72 107.72c6.23 6.23 16.34 6.23 22.58 0l25.03-25.03c6.23-6.23 6.23-16.34 0-22.58L207.6 256z"})}),Kr=["title","spacingClasses","children"],Vr=e=>{let{title:t,spacingClasses:r,children:a}=e,i=l(e,Kr);return n(_r,o(o({requestCloseOnClickOutside:!0,insertTop:s(c,{children:[n("div",{className:"dialog-border-top"}),n("div",{className:"dialog-title",children:n("div",{className:"dialog-title-text",children:t})}),n("div",{className:"dialog-close",onClick:i.onRequestClose,children:n(Hr,{})})]}),insertBottom:n("div",{className:"dialog-border-bottom"}),insertLeft:n("div",{className:"dialog-border-left"}),insertRight:n("div",{className:"dialog-border-right"})},i),{},{className:`dialog-theme-wood ${r||"dialog-spacing-10 dialog-spacing-fluid dialog-spacing-top-fixed"} ${i.className}`,children:a}))},Zr=e=>{let{dialogIsOpen:t,closeDialog:r}=e;return n(Vr,{className:"score-rules-dialog",isOpen:t,onRequestClose:r,requestCloseOnClickOutside:!0,title:"Score",spacingClasses:"dialog-spacing-10 dialog-spacing-fixed",children:s(c,{children:[s("div",{className:"dialog-box",children:[n("div",{className:"dialog-label",children:"Combinaisons de dés"}),s("div",{className:"columns",children:[s("div",{className:"column",children:[n("div",{className:"column-title",children:"Symbols identiques"}),n("span",{className:"symbol-number",children:"Combo 3"}),n("span",{className:"symbol-number",children:"Combo 4"}),n("span",{className:"symbol-number",children:"Combo 5"}),n("span",{className:"symbol-number",children:"Combo 6"}),n("span",{className:"symbol-number",children:"Combo 7"}),n("span",{className:"symbol-number",children:"Combo 8"})]}),s("div",{className:"column",children:[n("div",{className:"column-title",children:"Points"}),n("span",{className:"points",children:"100"}),n("span",{className:"points",children:"200"}),n("span",{className:"points",children:"500"}),n("span",{className:"points",children:"1000"}),n("span",{className:"points",children:"2000"}),n("span",{className:"points",children:"4000"})]})]})]}),s("div",{className:"dialog-box",children:[n("div",{className:"dialog-label",children:"Dés spéciaux"}),s("div",{className:"columns",children:[s("div",{className:"column",children:[n("div",{className:"column-title",children:"Symbol"}),n(qe,{src:Q}),n(qe,{src:ee})]}),s("div",{className:"column",children:[n("div",{className:"column-title",children:"Points"}),n("span",{className:"points",children:"100"}),n("span",{className:"points",children:"100"})]})]})]}),s("div",{className:"dialog-box last",children:[n("div",{className:"dialog-label",children:"Bonus coffre parfait"}),s("div",{className:"columns",children:[s("div",{className:"column",children:[n("div",{className:"column-title",children:"Dés utilisés"}),n("span",{className:"symbol-number",children:"8"})]}),s("div",{className:"column",children:[n("div",{className:"column-title",children:"Points"}),n("span",{className:"points",children:"500"})]})]})]})]})})},Xr=["id","value"],Jr=function(){let{totalScore:e=0,onScoreParticleAdded:t=(()=>{}),onScoreParticleRemoved:n=(()=>{}),onScoreParticleMerged:s=(()=>{})}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const[a,c]=r.useState(e),[i,d]=r.useState([]);r.useEffect((()=>{c(e)}),[e]);const u=i.reduce(((e,t)=>e+t.value),0);return[i,e=>{let{id:r,value:a}=e,i=l(e,Xr);const u=o(o({id:r,value:a},i),{},{oncancel:()=>{m()},onfinish:()=>{m(),s(u),c((e=>e+a))}}),m=(e=>{d((t=>[...t,e])),t(e);let r=!1;return()=>{r||(r=!0,d((t=>t.filter((t=>t!==e)))),c((t=>t-e.value)),n(e))}})(u);return m},a-u]},Qr=(e,t,r)=>{const n=nn(r),o=Math.cos(n),l=Math.sin(n),s=t.x-e.x,a=t.y-e.y;return{x:Math.round(o*s+l*a+e.x),y:Math.round(o*a-l*s+e.y)}},en=(e,t)=>{const r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)},tn=e=>{let[t,r,n,o]=e;return{x:(t.x+r.x+n.x+o.x)/4,y:(t.y+r.y+n.y+o.y)/4}},rn=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:tn(e);return e.map((e=>Qr(r,e,t)))},nn=e=>e*Math.PI/180,on=(e,t)=>{let[r,n]=e,[o,l]=t,s=(l.x-o.x)*(r.y-o.y)-(l.y-o.y)*(r.x-o.x),a=(n.x-r.x)*(r.y-o.y)-(n.y-r.y)*(r.x-o.x);const c=(l.y-o.y)*(n.x-r.x)-(l.x-o.x)*(n.y-r.y);if(0===s&&0===a&&0===c)return!1;if(0===c)return!1;s/=c,a/=c;return s>=0&&s<=1&&a>=0&&a<=1},ln=(e,t)=>an(e,(e=>sn(e,t))),sn=(e,t)=>!!an(t,(t=>on(e,t))),an=(e,t)=>{let[r,n,o,l]=e;if(t([r,n]))return!0;if(t([n,o]))return!0;if(t([o,l]))return!0;return!!t([l,r])},cn=(e,t)=>!(e.right<=t.left)&&(!(e.left>=t.right)&&(!(e.bottom<=t.top)&&!(e.top>=t.bottom))),dn=(e,t)=>{let r=e.left,n=e.right;const o=n-r;r<t.left?(r=t.left,n=r+o):n>t.right&&(r=t.right-o,n=r+o);let l=e.top,s=e.bottom;const a=s-l;return l<t.top?(l=t.top,s=l+a):s>t.bottom&&(l=t.bottom-a,s=l+a),{left:r,right:n,top:l,bottom:s}},un=(e,t)=>{const r=e.left-t.left,n=r+(e.right-e.left),o=e.top-t.top;return{left:r,right:n,top:o,bottom:o+(e.bottom-e.top)}},mn=(e,t)=>{let r=fn(t,e[0]);return e.reduce(((e,n)=>{const o=fn(t,n);return o<r?(r=o,n):e}))},hn=e=>{let{left:t,right:r,top:n,bottom:o}=e;return{x:t+(r-t)/2,y:n+(o-n)/2}},fn=(e,t)=>{const r=hn(e),n=hn(t);return en(r,n)},pn=e=>{const t=e.getBoundingClientRect(),r=te(e),n=t.left+r.x,o=t.top+r.y,l=n+t.width,s=o+t.height;return{left:Math.floor(n),top:Math.floor(o),right:Math.floor(l),bottom:Math.floor(s)}},gn=(e,t)=>{const r=pn(t);return dn(e,r)},vn=(e,t)=>{const r=pn(t),n=dn(e,r);return un(n,r)},bn=(e,t)=>{const r=pn(t),n=e.right-e.left,o=e.bottom-e.top;return{left:r.left+e.left,top:r.top+e.top,right:r.left+e.left+n,bottom:r.top+e.top+o}},yn=(e,t)=>{const r=pn(e);return cn(r,t)},Cn=(e,t)=>{const r=e.map((e=>pn(e))),n=mn(r,t);return e[r.indexOf(n)]},Nn=function(e){let{x:t,y:r}=e,{color:n="yellow",autoRemove:o=!0,autoRemoveAfter:l=2e3}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=document.createElement("div");s.style.position="absolute",s.style.zIndex="1000",s.style.left=`${t}px`,s.style.top=`${r}px`,s.style.width="5px",s.style.height="5px",s.style.background=n,s.style.border="1px solid red",document.body.appendChild(s);const a=()=>{document.body.removeChild(s)};let c;return o&&(c=setTimeout(a,l)),()=>{a(),clearTimeout(c)}},kn=e=>{let{totalScoreDomNodeRef:t,scoreParticle:r,animationDelayGetter:o=(()=>0)}=e;return"bonus"===r.type?n(Sn,{totalScoreDomNodeRef:t,scoreParticle:r,animationDelayGetter:o}):"combo"===r.type?n(xn,{scoreParticle:r,animationDelayGetter:o}):n(Dn,{scoreParticle:r,animationDelayGetter:o})},Sn=e=>{let{totalScoreDomNodeRef:t,scoreParticle:o,animationDuration:l=800,animationDelayGetter:a}=e;const c=re(o.symbol),i=r.useRef();return r.useEffect((()=>{const e=i.current,r=t.current,n=In(document.querySelector(`[data-chest-slot="${o.chestSlot}"]`));return wn({particleDomNode:e,totalScoreDomNode:r,x:n.x,y:n.y,duration:l,delay:a(),onfinish:o.onfinish,oncancel:o.oncancel})}),[]),s("svg",{ref:i,width:"32",height:"32",className:"score-particle--symbol",children:[n("image",{href:c,width:"32",height:"32"}),","]})},xn=e=>{let{scoreParticle:t,animationDuration:o=800,animationDelayGetter:l}=e;const[a,c]=An();return r.useEffect((()=>{const e=a.current,r=In(document.querySelector(".chest .box"));return Rn({particleDomNode:e,x:r.x,y:r.y,duration:o,delay:l(),onfinish:t.onfinish,oncancel:t.oncancel})}),[]),n("svg",{ref:a,className:"score-particle--perfect",children:n("g",{ref:c,children:s("text",{x:"0",y:"0",dominantBaseline:"text-before-edge",children:["Combo ",t.symbolCount]})})})},Dn=e=>{let{scoreParticle:t,animationDuration:o=800,animationDelayGetter:l}=e;const[s,a]=An();return r.useEffect((()=>{const e=s.current,r=In(document.querySelector(".chest .box"));return Rn({particleDomNode:e,x:r.x,y:r.y,duration:o,delay:l(),onfinish:t.onfinish,oncancel:t.oncancel})}),[]),n("svg",{ref:s,className:"score-particle--combo",children:n("g",{ref:a,children:n("text",{x:"0",y:"0",dominantBaseline:"text-before-edge",children:"Coffre parfait"})})})},wn=e=>{let{particleDomNode:t,totalScoreDomNode:r,x:n,y:o,duration:l,delay:s,onfinish:a=(()=>{}),oncancel:c=(()=>{})}=e;const i=pn(t),d=pn(r),u=i.right-i.left,m=i.bottom-i.top,h=n-u/2,f=o-m/2,p=h,g=f-1.1*m,v=d.left,b=d.top;t.style.left=`${h}px`,t.style.top=`${f}px`;const y=t.animate([{opacity:0,visibility:"visible",transform:"translate(0px, 0px)"},{offset:.1,opacity:1},{offset:.6,opacity:1,transform:`translate(${p-h}px, ${g-f}px)`},{transform:`translate(${v-h}px, ${b-f}px)`}],{duration:l,delay:s,fill:"forwards"});return y.onfinish=()=>{a()},()=>{c(),y.cancel()}},Rn=e=>{let{particleDomNode:t,x:r,y:n,duration:o,delay:l,onfinish:s=(()=>{}),oncancel:a=(()=>{})}=e;const c=pn(t),i=r-(c.right-c.left)/2,d=n-(c.bottom-c.top)/2;t.style.left=`${i}px`,t.style.top=`${d}px`;const u=t.animate([{opacity:0,visibility:"visible",transform:"translate(0px, 0px)"},{offset:.1,opacity:1},{offset:.4,opacity:1,transform:"scale(1.2)"},{}],{duration:o,delay:l,fill:"forwards"});return u.onfinish=()=>{s()},()=>{a(),u.cancel()}},An=()=>{const e=r.useRef(),t=r.useRef();return r.useLayoutEffect((()=>{const r=e.current,n=t.current.getBBox();r.setAttribute("width",Math.ceil(n.width)),r.setAttribute("height",Math.ceil(n.height))}),[]),[e,t]},In=e=>{const t=pn(e);return hn(t)},On=e=>{let{addScoreParticle:t}=e;En({addScoreParticle:t}),Ln({addScoreParticle:t}),Pn({addScoreParticle:t}),Mn({addScoreParticle:t})},En=e=>{let{addScoreParticle:t}=e;const r=L(),n=E(),o=vt();Object.keys(r).forEach((e=>{const l=r[e],s=_e(l,n),a=s&&se(s);Ie((()=>{if(!o&&a)return t({id:`chest-slot-${e}-coin`,type:"bonus",value:100,symbol:x,chestSlot:e})}),[o,a])}))},Ln=e=>{let{addScoreParticle:t}=e;const r=L(),n=E(),o=vt();Object.keys(r).forEach((e=>{const l=r[e],s=_e(l,n),a=s&&ae(s);Ie((()=>{if(!o&&a)return t({id:`chest-slot-${e}-diamond`,type:"bonus",value:100,symbol:S,chestSlot:e})}),[o,a])}))},Mn=e=>{let{addScoreParticle:t}=e;const n=L(),o=E(),l=vt(),s=r.useMemo((()=>{const e=[];Object.keys(n).forEach((t=>{const r=n[t];if(!r)return;"dice"===r.type&&e.push(_e(r,o))}));const{perfectBonus:t}=Ke(e);return Boolean(t)}),[n,o]);Ie((()=>{if(!l&&s)return t({id:"perfect",type:"perfect",value:500})}),[l,s])},Pn=e=>{let{addScoreParticle:t}=e;const n=L(),o=E(),l=U(),s=I(l),a=vt();ne.forEach((e=>{const l=[];Object.keys(n).forEach((t=>{const r=n[t],a=_e(r,o);a&&qn(a,e,s)&&l.push(t)}));const c=l.length,i=Tn[c]||0,d=r.useRef(i),u=r.useRef((()=>{}));Ie((()=>{const r=d.current,n=Boolean(r&&i&&r<i),o=Boolean(r&&i&&r>i);if(d.current=i,v(s)&&le(e))return;if(a)return;if(!i)return;if(o)return void u.current();n&&u.current();const m=t({id:`${c}-${e}-combo`,type:"combo",value:i-r,symbol:e,symbolCount:c});u.current=m;const h=l.map((e=>{const t=(document.querySelector(`[data-chest-slot="${e}"] image`)||document.querySelector(`[data-chest-slot="${e}"] img`)).animate([{transform:"scale(1)",transformOrigin:"center center"},{transform:"scale(1.2)",transformOrigin:"center center"},{transform:"scale(1)",transformOrigin:"center center"}],{duration:400});return()=>{t.cancel()}}));return()=>{m(),h.forEach((e=>{e()}))}}),[a,s,i])}))},qn=(e,t,r)=>{if(e===t)return!0;if(v(r)){if(oe(e)&&le(t))return!0;if(le(e)&&oe(t))return!0}return!1},Tn={3:100,4:200,5:500,6:1e3,7:2e3,8:4e3},({useState:jn,useEffect:Un}=r),Bn=()=>{const e=I(U()),t=$n();return n("div",{className:"score-area "+(t?"animated":""),children:e?n(Fn,{}):null})},$n=()=>{const e=I(U()),t=rt(),r=Ye(t,D),n=bt();if(!g(e))return!1;return!(r>=n)},Fn=()=>{const e=I(U()),t=G(),r=$n(),[o,l,a]=zr(),i=z();return s(c,{children:[C(e)?n(Hn,{}):null,t?n(Wr,{}):null,n("button",{className:"round-score "+(r?"hidden":""),onClick:l,children:n(i?zn:Gn,{})}),g(e)?n(Kn,{}):null,n(Zr,{dialogIsOpen:o,closeDialog:a})]})},Gn=()=>{const e=gt(),t=r.useRef(),[o,l]=Wt(),[a,i,d]=Jr({totalScore:e,onScoreParticleMerged:l});On({addScoreParticle:i}),Wn({roundScoreDomNodeRef:t,scoreParticleMergedListener:o});const u=r.useRef(null),m=()=>{const e=u.current,t=_n(e,600);return u.current=Date.now()+t,t};return s(c,{children:[n("span",{ref:t,className:"round-score--value",children:n(Xt,{value:d,condition:(e,t)=>e>t,duration:600})}),a.map((e=>n(kn,{totalScoreDomNodeRef:t,scoreParticle:e,animationDelayGetter:m},e.id)))]})},_n=(e,t)=>{if(!e)return 0;const r=t-(Date.now()-e);return r<=0?0:r},zn=()=>{const e=gt();return n("span",{className:"round-score--value",children:e})},Wn=e=>{let{roundScoreDomNodeRef:t,scoreParticleMergedListener:n}=e;const o=Yt(n);r.useEffect((()=>{if(!o)return;const e=t.current;return Yn({roundScoreDomNode:e})}),[o])},Yn=e=>{let{roundScoreDomNode:t,duration:r=500,easing:n="ease-in-out"}=e;const o=t.animate([{transform:"scale(1.8)"}],{duration:r,easing:n});return()=>{o.cancel()}},Hn=()=>{const e=H();return n("div",e?{className:"pirate-hook"}:{style:{display:"none"},className:"pirate-hook"})},Kn=()=>{const e=gt(),t=rt(),r=Ye(t,D),o=bt(),l=new Array(o).fill(""),a=r>=o,i=Oe((e=>e<r),[r]),[d,u]=jn(!1);return Un((()=>{i&&u(!0)}),[i]),Un((()=>{if(d){const e=setTimeout((()=>{u(!1)}),300);return()=>{clearTimeout(e)}}return()=>{}}),[d]),s(c,{children:[n("div",{className:"ropes "+(a?"challenge-won":""),children:l.map(((e,t)=>n("div",r>=t+1?{className:`rope rope-${t+1} cut-rope`}:{className:`rope rope-${t+1}`},t)))}),d&&r<=o?s("div",{className:"sword-slice",children:[n("div",{className:"triangle-left"}),n("div",{className:"triangle-right"})]}):null,n("div",{className:`negative-round-score rotate-${r} ${a?"removed":""}`,children:e})]})},Vn=50,Zn=new URL(__v__("/mille-sabords/other/cursed-grid.png"),t.meta.url),Xn=e=>{let{chestRef:t,diceOverChestListener:r}=e;const l=L(),a=dt(),c=Yt(r),i=I(U()),d=a&&_(i);return s("div",{className:"chest",children:[s("div",{ref:t,className:"dice-area "+(_(i)?"glow":""),style:o({},c?{outline:"2px dotted"}:{}),children:[n("div",{className:"box",children:Object.keys(l).map((e=>n("div",{className:"slot","data-chest-slot":e,children:n(Jn,{chestSlotContent:l[e]})},e)))}),n("div",{className:"top-left-corner"}),n("div",{className:"top-right-corner"}),n("div",{className:"bottom-left-corner"}),n("div",{className:"bottom-right-corner"}),a&&!d?n(Qn,{}):null]}),n(Bn,{})]})},Jn=e=>{let{chestSlotContent:t}=e;const r=I(U());if(!t)return null;if("symbol"===t.type){const e=t.value;return n("button",{className:"dice",style:{width:Vn,height:Vn,color:"#eaeaea",margin:"5px",backgroundColor:r.color1,borderColor:r.color2,borderWidth:"2px",borderStyle:"solid"},children:n(qe,{src:re(e),draggable:"false",style:{width:"100%",height:"100%"}})})}return null},Qn=()=>n("div",{className:"cursed-cover",children:n(qe,{draggable:"false",src:Zn,alt:"cursed-cover"})}),eo={animals:{name:"Animaux",rule:"Les singes et les perroquest obtenus sur les dés comptent comme un même symbol dans une combinaison.",more:"Par exemple 2 perroquets et 3 singes forment une conbinaison de 5 dés identiques, soit 500 points."},chest:{name:"Coffre au trésor",rule:'Lorsque le joueur sauvegarde ses dés, grâce à la carte "Coffre au trésor" les dés sont protégés du mauvais sort.',more:"Ainsi même lorsque le joueur obtient 3 têtes de morts, son tour prends fin, mais il peut marquer les points totalisés grâce aux dés sauvegardés!"},coin:{name:"Pièce d'or",rule:"Le joueur commence son tour avec un symbol pièce d'or. Il rapporte des points aussi bien dans une combinaison de dés que comme simple pièce (+100)."},diamond:{name:"Diamant",rule:"Le joueur commence son tour avec un symbol diamant. Il rapporte des points aussi bien dans une combinaison de dés que comme simple diamant (+100)."},pirate:{name:"Capitaine des pirates",rule:"Grâce à l'aide du capitaine, tous les points comptabilisés pendant ce tour sont doublés !"},witch:{name:"Sorcière",rule:"Avec ses potions magiques, la sorcière permet exceptionnellement au joueur de relancer, une fois, un dé avec une tête de mort."},"1skull":{name:"Tête de mort",rule:"Le tour du joueur débute avec un symbole tête de mort."},"2skulls":{name:"2 têtes de mort",rule:"Le tour du joueur débute avec 2 symboles tête de mort."},"2sword-challenge":{name:"Bateau pirate",rule:"Le joueur doit obtenir au minimum 2 symbols sabres. Si il y parvient, il gagne +300 points, en plus de son résultat aux dés. Si il échoue, le joueur marque -300 points pour ce tour, quelque soit son résultat aux dés.",more:"Le score total ne peut pas descende en dessous de zéro. Ainsi si par exemple le joueur perds le défi au premier tour il restera à 0 points."},"3sword-challenge":{name:"Bateau pirate",rule:"Le joueur doit obtenir au minimum 3 symbols sabres. Si il y parvient, il gagne +500 points, en plus de son résultat aux dés. Si il échoue, le joueur marque -500 points pour ce tour, quelque soit son résultat aux dés.",more:"Le score total ne peut pas descende en dessous de zéro. Ainsi si par exemple le joueur perds le défi au premier tour il restera à 0 points."},"4sword-challenge":{name:"Bateau pirate",rule:"Le joueur doit obtenir au minimum 4 symbols sabres. Si il y parvient, il gagne +1000 points, en plus de son résultat aux dés. Si il échoue, le joueur marque -1000 points pour ce tour, quelque soit son résultat aux dés.",more:"Le score total ne peut pas descende en dessous de zéro. Ainsi si par exemple le joueur perds le défi au premier tour il restera à 0 points."}},to=e=>{let{dialogIsOpen:t,closeDialog:r,card:o}=e;const l=eo[o.type];return n(Vr,{className:"card-rules-dialog",isOpen:t,onRequestClose:r,requestCloseOnClickOutside:!0,title:"Carte",children:l?s(c,{children:[n("div",{className:"dialog-label",children:l.name}),n("div",{style:{textAlign:"center"},children:n(qe,{className:"current-card",src:ce(o),width:"150",alt:o.type})}),n("div",{className:"text-rule",children:l.rule}),l.more?n("div",{className:"text-rule",children:l.more}):null]}):"No rule"})},ro=["card"],no=(e,t)=>{let{card:r}=e,s=l(e,ro);return n("div",o(o({className:"card current-card",ref:t,width:"55",height:"55",style:{backgroundColor:r.color1,borderColor:r.color2}},s),{},{children:n(qe,{src:ie(r),alt:r.type,width:"55",height:"55"})}))},oo=r.forwardRef(no),lo=new URL(__v__("/mille-sabords/other/swords-disabled.png"),t.meta.url),so=()=>{const e=U(),t=rt(),r=bt();if(!e)return null;const o=I(e);if(!g(o))return null;const l=Ye(t,D),s=new Array(r).fill("");return n("div",{className:"sword-challenge-indicators",children:s.map(((e,t)=>n(l>=t+1?ao:co,{},t)))})},ao=()=>n("div",{className:"sword-icon",children:n(qe,{src:h})}),co=()=>n("div",{className:"sword-icon disabled",children:n(qe,{src:lo})}),io=e=>{let{openScoreboard:t,headerSmallCardRef:r}=e;const o=I(U()),l=H();return s("div",{className:"header",children:[s("div",{className:"card-container",style:{opacity:l?"1":"0"},children:[n("div",{className:"small-card",children:o?n(uo,{headerSmallCardRef:r,currentCard:o}):n(mo,{})}),l&&n(so,{})]}),n(ho,{openScoreboard:t}),n(fo,{})]})},uo=e=>{let{headerSmallCardRef:t,currentCard:o}=e;const[l,a]=r.useState(!1);return s(c,{children:[n(oo,{onClick:()=>{a(!0)},card:o,ref:t}),n(to,{card:o,dialogIsOpen:l,closeDialog:()=>{a(!1)}})]})},mo=()=>n("div",{className:"card default-card",style:{backgroundImage:`url(${de})`,backgroundSize:"217px"}}),ho=e=>{let{openScoreboard:t}=e;const r=Je();return n(qe,{onClick:t,className:"avatar",src:r&&r.character.img,alt:"player",style:{borderColor:r&&r.character.color||"white"},width:"55",height:"55"})},fo=()=>{const e=Je(),t=e.score,r=Vt(t,{duration:1200,timingFunction:e=>1-Math.pow(1-e,5)});return n("div",{className:"total-score",children:n("span",{className:"score",style:{backgroundColor:e&&e.character.color||"white"},children:r?r.value:t})})},po=6.25,go=(e,t)=>{let{rolledAreaDomNode:r}=t;const n=pn(r),o=n.right-n.left,l=n.bottom-n.top,s={left:po,right:o-56.25,top:po,bottom:l-56.25},a=[];return e.forEach(((e,t)=>{e.visibleFaceIndex=yo(e);const{rectangle:r,rotation:n,rotatedRectangle:o}=(e=>{let t=0;const r=()=>{const n=vo(e,s),o=bo(),l=rn(n,o);return!a.some((e=>ln(l,e)))||t>50?{rectangle:n,rotation:o,rotatedRectangle:l}:(t++,r())};return r()})(e);a.push(o),e.rolledAreaZIndex=t+1,e.rolledAreaPosition=r[0],e.rotation=n})),e},vo=(e,t)=>{const r={x:Co(t.left,t.right),y:Co(t.top,t.bottom)};return[{x:r.x,y:r.y},{x:r.x+Vn,y:r.y},{x:r.x+Vn,y:r.y+Vn},{x:r.x,y:r.y+Vn}]},bo=()=>Co(-35,35),yo=e=>Co(0,e.faces.length-1),Co=(e,t)=>Math.floor(Math.random()*(t-e+1)+e),No=e=>{let{rolledAreaRef:t}=e;const r=at(),o=M(),l=Qe(),a=ko(),c=I(U()),i=dt(),d=o.length<2&&!l,u=i&&_(c);return r?s("div",{className:"roll-action",children:[s("button",{onClick:()=>{a(t.current)},disabled:d||u,children:["Lancer",d&&!u&&n("span",{className:"button-subtitle",children:"(au moins 2 dés !)"})]}),u&&n(qe,{src:ue,className:"skull-symbol"})]}):null},ko=f(((e,t)=>{const{dices:r,rollCount:n,diceRolledIds:l}=e,s=(0===n?Object.keys(r):l).map((e=>r[e]));return go(s,{rolledAreaDomNode:t}),o(o({},e),{},{rollCount:n+1,witchUncursedDiceId:null,diceRolledIds:s.map((e=>e.id)),dices:o({},r)})})),So=e=>{let{onRoundOver:t,rolledAreaRef:r}=e;return s("div",{className:"footer actions",children:[n(No,{rolledAreaRef:r}),n(xo,{}),n(Do,{onRoundOver:t})]})},xo=()=>{const e=gt(),t=St(),r=ft(),o=ht(),l=e<0?"-":"+";return o?s("div",{className:"collect-action",children:[s("button",{onClick:()=>{t(e)},disabled:!r,children:[n("span",{children:"Collecter"}),s("span",{className:"score",children:[l," ",Math.abs(e)]})]}),!r&&n(qe,{src:ue,className:"skull-symbol"})]}):null},Do=e=>{let{onRoundOver:t}=e;const r=pt(),o=Ct(),l=gt(),s=dt(),a=vt(),c=rt();return r?n("div",{className:"next-round-action",children:n("button",{onClick:()=>{o(),t({reason:s?"3-skulls":a?"chalenge-failed":"user-collect",value:l,symbolsInChest:c})},children:"Terminer mon tour"})}):null},wo=new URL(__v__("/mille-sabords/other/witch-label.png"),t.meta.url),Ro=e=>{let{cursedAreaRef:t}=e;const r=I(U());return s("div",{className:"skull-island",children:[me(r)?n(Io,{}):null,n("div",{className:"bottle",children:s("div",{className:"area",ref:t,children:[B(r)?n(Ao,{card:r}):null,F(r)?s(c,{children:[n(Ao,{card:r}),n(Ao,{card:r})]}):null]})})]})},Ao=e=>{let{card:t}=e;return n("button",{className:"dice",style:{width:Vn,height:Vn,color:"#eaeaea",margin:"1px 5px",backgroundColor:t.color1,borderColor:t.color2,borderWidth:"2px"},children:n(qe,{src:ue,style:{width:"100%",height:"100%"}})})},Io=()=>H()?s("div",{className:"witch-label",children:[n(qe,{src:wo}),s("svg",{x:"0px",y:"0px",width:"156.083px",height:"208.667px",viewBox:"0 0 156.083 208.667",children:[n("path",{id:"path_01",fill:"none",stroke:"#E4AD30",d:"M8.406,107.82 c2.541,2.178,2.375,2.875,14.25,3.5c14.782,0.778,19.26-11.965,19.26-11.965S47.918,88,40.251,72.917s-18.916,4.583-9.083,8.167 s27.759-1.338,35.142-12.417C74.75,56,77.583,45.333,79.25,37S78.477,15.833,66.31,3.833"}),n("path",{id:"path_02",fill:"none",stroke:"#E4AD30",d:"M44.031,110.094 c0,0,1,1.313-4.438,3.344s-14.244,7.281-32.125-2"}),n("path",{id:"path_03",fill:"none",stroke:"#E4AD30",d:"M42.125,103.688 c0,0,1.313,6.594-9.313,8.625S10.281,108.719,9.406,101"}),n("path",{id:"path_04",fill:"none",stroke:"#E4AD30",d:"M33.114,112.253c0,0,39.886-19.253,43.011,24.747 c0.372,0.447-0.959,1.208-2.542,1.625"})]})]}):n(qe,{style:{display:"none"},src:wo}),Oo=e=>{let{parent:t,children:r}=e;return t?a.createPortal(n(c,{children:r}),t):null},Eo=e=>{let{rotate:t,scale:r,translate:n}=e;return[...t?[`rotate(${t}deg)`]:[],...r&&1!==r?[`scale(${r})`]:[],...n?[`translate(${n})`]:[]].join("")},Lo=function(e){let t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60,{trailing:o=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const l=function l(){for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];clearTimeout(t);const i=Date.now();if(r){const s=i-r;if(s<n){if(o){t=setTimeout((()=>l(...a)),n-s)}}else r=i,e(...a)}else r=i,e(...a)};return l.cancel=()=>{clearTimeout(t)},l},Mo=(e,t)=>{let{logLevel:r="warn",onGrip:n=(()=>{}),onLongGrip:l=(()=>{}),onClick:s=(()=>{}),onDrag:a=(()=>{}),onRelease:c=(()=>{}),onCancel:d=(()=>{}),longGripMs:u=300}=t;const m=i({logLevel:r});let h,f,p=!1,g=()=>{},v=()=>{},b=()=>{};m.debug("enable drag on",e);const y=he(e,"dragstart",(e=>{e.preventDefault()})),C=he(e,"mousedown",(e=>{if(3===e.which)return void m.debug("ignore right click");A(qo(e),e);const t=Lo((e=>{O(qo(e),e)}));b=()=>t.cancel(),g=he(document,"mousemove",t),v=he(document,"mouseup",(e=>{v(),g(),E(qo(e),e)}))}),{passive:!0}),N=he(e,"touchstart",(e=>{A(To(e),e);const t=Lo((e=>{O(To(e),e)}));b=()=>t.cancel(),g=he(document,"touchmove",t),v=he(document,"touchend",(e=>{v(),g(),E(To(e),e)}))}),{passive:!0}),k=he(e,"click",(e=>{p||"none"!==R||s(e)}));let S,x,D,w,R;const A=(t,r)=>{m.debug("gripping node at",t),f=!0,R="none",D=t,S=t,x=Po(e),n({x:x.x,y:x.y,event:r}),w=setTimeout(I,u)},I=()=>{p=!0,l()},O=(e,t)=>{if(S.x===e.x&&S.y===e.y)return void m.debug("no real move");S=e;const r=D.x-x.x,n=D.y-x.y,l={x:e.x-r,y:e.y-n},s=e.x-D.x,c=e.y-D.y;m.debug("move node at",l),a(o(o({event:t},l),{},{relativeX:s,relativeY:c,setDropEffect:e=>{R=e}}))},E=(e,t)=>{m.debug("releasing node"),f=!1,clearTimeout(w);const r=D.x-x.x,n=D.y-x.y;c({event:t,dropEffect:R,x:S.x-r,y:S.y-n}),h=setTimeout((()=>{p=!1}))};return e=>{y(),k(),C(),N(),g(),v(),clearTimeout(w),clearTimeout(h),b(),(e=>{f&&(m.debug("cancelling drag",e),f=!1,d({event:e}))})(e)}},Po=e=>{const t=e.getBoundingClientRect();return{x:t.left,y:t.top}},qo=e=>({x:e.pageX,y:e.pageY}),To=e=>{const t=e.changedTouches[0];return{x:t.pageX,y:t.pageY}},({useEffect:jo,useState:Uo}=r),Bo=e=>{let{dice:t,diceAnimation:r,anmationDebug:o=!1,parentNode:l,zIndex:a,x:c,y:i,rotation:d,draggable:u,onDiceClick:m,onDiceDrag:h,onDiceDrop:f,onDiceDragEnd:g,disapear:v,appear:b,traceUpdate:y=!1}=e;const C=J(),N=fe(t.id),k=pe(t.id),S=lt().includes(t.id),[x,D]=Uo(!1),[w,R]=Uo(null),A=Le(l),I=r?A:l;jo((()=>{if(!u||!N||!C)return()=>{};let e=!1;const r=Mo(N,{onGrip:()=>{D(!0)},onClick:e=>{m(t,e)},onDrag:r=>{let{x:n,y:o,relativeX:l,relativeY:s,setDropEffect:a}=r;const c=gn({left:n,right:n+Vn,top:o,bottom:o+Vn},C);R({x:c.left,y:c.top}),e=e||Math.abs(l)>10||Math.abs(s)>10,e&&h(t,{relativeX:l,relativeY:s,setDropEffect:a,diceRectangle:c})},onRelease:e=>{let{dropEffect:r,x:n,y:o}=e;if("none"!==r){f(t,{diceRectangle:{left:n,right:n+Vn,top:o,bottom:o+Vn}})}D(!1),R(null),g(t)},onCancel:()=>{D(!1),R(null),g(t)}});return()=>{r()}}),[u,N,C,m,h,f,g]),jo((()=>{if(!r||!N)return()=>{};const{from:e,to:t,onfinish:n}=r;o&&(Nn(e),Nn(t));const l=`translate(${Math.floor(t.x-e.x)}px, ${Math.floor(t.y-e.y)}px)`,s=N.parentNode.animate([{transform:l}],{duration:500,fill:"forwards",easing:"cubic-bezier(0, 0.55, 0.45, 1)"});return s.onfinish=n,()=>{s.cancel()}}),[N,r]);const O=q(t),E=r&&r.from?r.from.x:w?w.x:c,L=r&&r.from?r.from.y:w?w.y:i,M=w||r?1e3:a;return n(Oo,{parent:I,children:n("svg",{"data-dice-id":t.id,className:"dice",onClick:u?void 0:e=>{m(t,e)},style:{width:Vn,height:Vn,left:`${E}px`,top:`${L}px`,zIndex:M,cursor:u?x?"grabbing":"grab":void 0,position:w||r?"fixed":void 0},children:s("g",{ref:k,className:v?"dice-cursed-disapear":b?"dice-cursed-appear":"",style:{transform:Eo({rotate:d||0,scale:x?"1.1":"1"}),transitionProperty:"transform",transitionDuration:"500ms",transitionTimingFunction:"cubic-bezier(0, 0.55, 0.45, 1)",transformOrigin:"center center"},children:[n("rect",{className:"dice-background",width:"100%",height:"100%",rx:"5",ry:"5",fill:$o(O,S).fill,stroke:$o(O,S).stroke,strokeWidth:"1"}),n("image",{href:re(p(t)),draggable:"false",style:{width:"100%",height:"100%"}})]})})})},$o=(e,t)=>e?{fill:"black",stroke:"black"}:t?{fill:"none",stroke:"none"}:{fill:"#eaeaea",stroke:"#b9b9b9"},Fo=e=>{let{offscreenDomNode:t,chestDomNode:l,rolledAreaDomNode:s,cursedAreaDomNode:a,onDiceOverChestChange:c=(()=>{}),onDiceOverRolledAreaChange:i=(()=>{})}=e;const d=E(),u=L(),m=M(),h=T(),f=P(),p=ge(),g=I(U()),v=G(),b=it(),y=ot(),[C,N]=r.useReducer(((e,t)=>o(o({},e),{},{[t.key]:t.value})),{}),k=Dt(),S=Ot(),x=It(),D=At(),w=wt(),R=r.useRef(null);return Object.keys(d).map((e=>{const A=d[e],I=ol(A,{chestSlots:u,diceRolledIds:m,diceCursedIds:h}),O=ll(I,{chestDomNode:l,rolledAreaDomNode:s,cursedAreaDomNode:a,offscreenDomNode:t}),{parentNode:E}=O,L=A.id!==f&&E===s&&q(A),M=E===a,P=Wo(A,m),T=r.useCallback((e=>{const t=Go(e,{currentCard:g,witchCardEffectUsed:p,diceIsInRolledArea:P,diceIsInCursedArea:M,chestSlots:u,hasDicesToCurse:y,threeSkullsOrMore:b,scoreMarked:v});if("keep"===t){const t=el(u);S(e,t)}else"unkeep"===t?x(e):"uncurse"===t&&D(e)}),[P,M,u,v,b,g,p]),j=r.useCallback(((e,t)=>{R.current=zo({dragDiceGesture:t,chestDomNode:l,rolledAreaDomNode:s});const r=_o(e,{diceIsInRolledArea:P,chestSlots:u,dropTargetRef:R,rolledAreaDomNode:s,chestDomNode:l,hasDicesToCurse:y,threeSkullsOrMore:b,scoreMarked:v});t.setDropEffect(r),c("keep"===r?e:null),i("unkeep"===r?e:null)}),[P,u,R,s,l,v,b,c,i]),U=r.useCallback(((e,t)=>{const r=_o(e,{diceIsInRolledArea:P,chestSlots:u,dropTargetRef:R,rolledAreaDomNode:s,chestDomNode:l,scoreMarked:v,threeSkullsOrMore:b});let n=!1,o=null;if("reposition-in-rolled-area"===r){const r=Jo(t.diceRectangle,s),n=Qo(e,{dices:d,diceRolledIds:m});k(e,r,n)}else if("back-to-rolled-area"===r)n=!0,o=Zo(e.rolledAreaPosition,s);else if("keep"===r){const r=tl(e,{chestSlots:u,rectangle:t.diceRectangle,chestDomNode:l});S(e,r),n=!0,o=Xo(r,l)}else if("reposition-in-chest"===r){const r=tl(e,{chestSlots:u,rectangle:t.diceRectangle,chestDomNode:l});rl(e,u)!==r&&(w(e,r),n=!0,o=Xo(r,l))}else if("back-to-chest"===r){const t=rl(e,u);n=!0,o=Xo(t,l)}else if("unkeep"===r){const r=Jo(t.diceRectangle,s);k(e,r,Qo(e,{dices:d,diceRolledIds:m})),x(e),n=!0,o=Zo(r,s)}n&&N({key:e.id,value:{from:{x:t.diceRectangle.left,y:t.diceRectangle.top},to:o,onfinish:()=>{setTimeout((()=>{N({key:e.id,value:null})}))}}})}),[P,u,R,s,l,v,b]),B=r.useCallback((()=>{c(null),i(null)}),[c,i]),$=o(o({key:A.id},O),{},{dice:A,diceAnimation:C[A.id],witchCardEffectUsed:p,disapear:L,appear:M,onDiceClick:T,onDiceDrag:j,onDiceDrop:U,onDiceDragEnd:B});return r.useMemo((()=>n(Bo,o({},$))),Object.keys($).map((e=>$[e])))}))},Go=(e,t)=>{let{currentCard:r,witchCardEffectUsed:n,diceIsInRolledArea:o,diceIsInCursedArea:l,chestSlots:s,hasDicesToCurse:a,threeSkullsOrMore:c,scoreMarked:i}=t;return o?Ho(e,{hasDicesToCurse:a,threeSkullsOrMore:c,scoreMarked:i})?"keep":"none":Yo(e,s)?Ko(e,{threeSkullsOrMore:c,scoreMarked:i})?"unkeep":"none":l&&Vo(e,{currentCard:r,witchCardEffectUsed:n,scoreMarked:i,threeSkullsOrMore:c})?"uncurse":"none"},_o=(e,t)=>{let{diceIsInRolledArea:r,chestSlots:n,dropTargetRef:o,rolledAreaDomNode:l,chestDomNode:s,hasDicesToCurse:a,threeSkullsOrMore:c,scoreMarked:i}=t;return r?o.current===l?"reposition-in-rolled-area":o.current===s&&Ho(e,{hasDicesToCurse:a,threeSkullsOrMore:c,scoreMarked:i})?"keep":"back-to-rolled-area":Yo(e,n)?o.current===s?"reposition-in-chest":o.current===l&&Ko(e,{scoreMarked:i,threeSkullsOrMore:c})?"unkeep":"back-to-chest":"none"},zo=e=>{let{dragDiceGesture:t,chestDomNode:r,rolledAreaDomNode:n}=e;if(yn(r,t.diceRectangle))return r;return yn(n,t.diceRectangle)?n:null},Wo=(e,t)=>t.includes(e.id),Yo=(e,t)=>Object.keys(t).some((r=>{const n=t[r];return n&&"dice"===n.type&&n.value===e.id})),Ho=(e,t)=>{let{hasDicesToCurse:r,threeSkullsOrMore:n,scoreMarked:o}=t;return!q(e)&&(!r&&(!n&&!o))},Ko=(e,t)=>{let{scoreMarked:r,threeSkullsOrMore:n}=t;return!r&&!n},Vo=(e,t)=>{let{currentCard:r,witchCardEffectUsed:n,scoreMarked:o,threeSkullsOrMore:l}=t;return!!me(r)&&(!n&&(!o&&!l))},Zo=(e,t)=>{const r=bn({left:e.x,top:e.y,right:0,bottom:0},t);return{x:r.left,y:r.top}},Xo=(e,t)=>{const r=nl(e,t),n=pn(r);return{x:n.left+5,y:n.top+5}},Jo=(e,t)=>{const r=vn(e,t);return{x:r.left,y:r.top}},Qo=(e,t)=>{let{diceRolledIds:r,dices:n}=t;if(0===r.length)return 1;const o=r.slice(1).reduce(((e,t)=>{const r=n[t];return r.rolledAreaZIndex>e.rolledAreaZIndex?r:e}),n[r[0]]);return o===e?e.rolledAreaZIndex:o.rolledAreaZIndex+1},el=e=>Object.keys(e).find((t=>!e[t])),tl=(e,t)=>{let{chestSlots:r,rectangle:n,chestDomNode:o}=t;const l=new Map,s=[];Object.keys(r).forEach((t=>{const n=r[t];if(!n||"dice"===n.type&&n.value===e.id){const e=nl(t,o);l.set(e,t),s.push(e)}}));const a=Cn(s,n);return l.get(a)},rl=(e,t)=>Object.keys(t).find((r=>{const n=t[r];return n&&"dice"===n.type&&n.value===e.id})),nl=(e,t)=>t.querySelector(`[data-chest-slot="${e}"]`),ol=(e,t)=>{let{chestSlots:r,diceRolledIds:n,diceCursedIds:l}=t;const s=Object.keys(r).find((t=>r[t]&&"dice"===r[t].type&&r[t].value===e.id));return s?{type:"chest-slot",value:s}:n.includes(e.id)?{type:"rolled-area",value:o(o({},e.rolledAreaPosition),{},{rotation:e.rotation,zIndex:e.rolledAreaZIndex})}:l.includes(e.id)?{type:"cursed-area",value:void 0}:{type:"offscreen-area"}},ll=(e,t)=>{let{type:r,value:n}=e,{chestDomNode:o,rolledAreaDomNode:l,cursedAreaDomNode:s,offscreenDomNode:a}=t;return"chest-slot"===r?{parentNode:o.querySelector(`[data-chest-slot="${n}"]`),zIndex:void 0,rotation:0,x:void 0,y:void 0,draggable:!0}:"rolled-area"===r?{parentNode:l,zIndex:n.zIndex,rotation:n.rotation,x:n.x,y:n.y,draggable:!0}:"cursed-area"===r?{parentNode:s,zIndex:void 0,rotation:0,x:void 0,y:void 0,draggable:!1}:{parentNode:a,zIndex:void 0,rotation:0,x:void 0,y:void 0,draggable:!1}},sl=e=>{let{dialogIsOpen:t,closeDialog:o,headerSmallCardRef:l}=e;const a=Xe(),c=U(),i=I(c)||null,d=r.useRef(),u=r.useRef(),m=r.useRef();return n(_r,{className:"draw-card-dialog dialog-spacing-10 dialog-spacing-fluid",isOpen:t,onRequestClose:o,requestCloseOnClickOutside:!1,children:s("div",{className:"dialog-content",children:[s("div",{className:"dialog-body",children:[s("div",{className:"dialog-label",children:[0===a.length&&!i&&"Paquet de cartes épuisé. Mélangez-le pour pouvoir piocher à nouveau !",0!==a.length&&!i&&"Piochez une carte pour le tour suivant.",i&&n("span",{className:"card-name",children:eo[i.type].name})]}),n("div",{className:"card-area",children:s("div",{style:{position:"relative"},children:[n(al,{backCardRef:d,currentCard:i,remainingCardCount:a.length}),n(cl,{topCardRef:u,smallCardRef:m,currentCard:i})]})})]}),s("div",{className:"dialog-actions",children:[n(il,{backCardRef:d,cardDeck:a,currentCard:i}),i?n(hl,{headerSmallCardRef:l,smallCardRef:m,backCardRef:d,topCardRef:u,currentCard:i,closeDialog:o}):null]})]})})},al=e=>{let{backCardRef:t,currentCard:r,remainingCardCount:o}=e;return s("div",{ref:t,className:"card default-card",style:{background:"none"},children:[n(qe,{src:de,width:"150"}),r?null:n("div",{className:"remaining-cards-number",children:o})]})},cl=e=>{let{topCardRef:t,smallCardRef:r,currentCard:o}=e;return o?s(c,{children:[n("div",{className:"card current-card",ref:t,children:n("div",{className:"flip-card",children:s("div",{className:"flip-card-inner",children:[n("div",{className:"flip-card-front",children:n(qe,{className:"card default-card",src:de})}),n("div",{className:"flip-card-back",children:n(qe,{className:"card-img",src:ce(o),width:"150",alt:o.type})})]})})}),n("div",{className:"small-card",children:n(oo,{card:o,ref:r})})]}):null},il=e=>{let{backCardRef:t,cardDeck:r,currentCard:o}=e;return o?null:0===r.length?n(ul,{backCardRef:t}):n(dl,{})},dl=()=>{const e=jt();return n("button",{className:"button-card-main button-draw-card",onClick:e,children:"Piocher"})},ul=e=>{let{backCardRef:t}=e;const o=z(),l=$t(),[s,a]=r.useState(!1);return r.useEffect((()=>s?(l(),o?(a(!1),()=>{}):ml({backCard:t.current,duration:1e3,onfinish:()=>{a(!1)}})):()=>{}),[s]),n("button",{className:"button-card-main button-shuffle-deck",onClick:()=>{a(!0)},children:"Mélanger"})},ml=e=>{let{backCard:t,duration:r,onfinish:n}=e;t.setAttribute("shaking-deck","");const o=setTimeout((()=>{t.removeAttribute("shaking-deck",""),n()}),r);return()=>{t.removeAttribute("shaking-deck",""),clearTimeout(o)}},hl=e=>{let{headerSmallCardRef:t,smallCardRef:o,backCardRef:l,topCardRef:s}=e;const a=z(),c=Nt(),[i,d]=r.useState(!1);return r.useEffect((()=>i?a?(c(),()=>{}):fl({headerSmallCard:t.current,smallCard:o.current,backCard:l.current,topCard:s.current,duration:500,onfinish:()=>{c()}}):()=>{}),[i]),n("button",{className:"button-card-main button-activate-card",onClick:()=>{i||d(!0)},children:"Commencer"})},fl=e=>{let{headerSmallCard:t,topCard:r,backCard:n,smallCard:o,duration:l,onfinish:s}=e;n.style.opacity=0;const a=pn(t),c=r.animate([{transform:"scale(1)",opacity:1},{transform:"scale(0)",opacity:0}],{duration:l,fill:"forwards"}),i=o.animate([{transform:"scale(0)",opacity:0,position:"fixed",top:`${a.top}.px`,left:`${a.left}.px`},{transform:"scale(1)",opacity:1,position:"fixed",top:`${a.top}.px`,left:`${a.left}.px`}],{duration:l,fill:"forwards"});return i.onfinish=s,()=>{c.cancel(),i.cancel()}},pl=e=>{let{openScoreboard:t,onRoundStart:o,onRoundOver:l}=e;const a=H(),[c,i]=r.useState(!1);r.useEffect((()=>{o()}),[]);const[d,u]=Wt(),[m,h]=Wt(),f=r.useRef();return s("div",{className:"round-container",children:[n(Ft,{}),n(io,{openScoreboard:t,headerSmallCardRef:f}),a?n(gl,{diceOverRolledAreaListener:d,diceOverChestListener:m,openScoreboard:t,onRoundOver:l,onRoundMounted:e=>{i(e)}}):null,c?n(Fo,{offscreenDomNode:c.offscreenDomNode,chestDomNode:c.chestDomNode,rolledAreaDomNode:c.rolledAreaDomNode,cursedAreaDomNode:c.cursedAreaDomNode,onDiceOverChestChange:h,onDiceOverRolledAreaChange:u}):null,n(sl,{dialogIsOpen:!a,headerSmallCardRef:f})]})},gl=e=>{let{diceOverRolledAreaListener:t,diceOverChestListener:o,onRoundMounted:l,onRoundOver:a}=e;const i=r.useRef(null),d=r.useRef(null),u=r.useRef(null),m=r.useRef(null);return r.useEffect((()=>{l({rolledAreaDomNode:i.current,chestDomNode:d.current,cursedAreaDomNode:u.current,offscreenDomNode:m.current})}),[]),s(c,{children:[n(Lt,{}),s("div",{className:"chest-and-skulls",children:[n(Xn,{chestRef:d,diceOverChestListener:o}),n(Ro,{cursedAreaRef:u})]}),n(Ht,{rolledAreaRef:i,offscreenRef:m,diceOverRolledAreaListener:t}),n(So,{onRoundOver:a,rolledAreaRef:i})]})},vl=e=>{let{closeDialog:t,dialogIsOpen:r,player:o}=e;const l=yt();return n(_r,{className:"score-board-dialog dialog-spacing-10 dialog-spacing-fluid dialog-spacing-left-fixed dialog-spacing-right-fixed",isOpen:r,onRequestClose:t,requestCloseOnClickOutside:!0,children:s("div",{className:"dialog-content",children:[n("div",{className:"dialog-close",onClick:t,children:n(Hr,{})}),s("div",{className:"dialog-body",children:[s("div",{children:["Au tour de",n("div",{className:"dialog-label",children:o.character.name}),n(qe,{className:"player-img",src:o&&o.character.img,alt:"player",width:"40",height:"40",style:{boxShadow:`inset 0px 0px 0px 4px ${o&&o.character.color||"black"}`}})]}),n("div",{className:"dialog-actions",children:n("button",{onClick:()=>{t(),l(o)},children:"Jouer"})})]})]})})},bl=new URL(__v__("/mille-sabords/other/win-treasure.png"),t.meta.url),yl=new URL(__v__("/mille-sabords/other/boat.png"),t.meta.url),Cl=6e3,Nl={path1:"M39.582,739.564c0-91.824,39.191-96.32,38.045-166.691s-30.042-70.37-47.326-161.729s38.128-86.388,31.276-186.42C55.405,134.602-3.014,89.176,8.812,129.825c5.333,18.333,30.77-21,30.77-129.825",path2:"M39.582,739.564c0-113.074-5.437-166.074-8.437-198.074s36-20.667,33.019-2c-1.796,11.248-24.583,13.333-23.699-22c1.229-49.158,22.68-111,23.68-169s-38-95-46-181S39.582,0,39.582,0",path3:"M39.582,739.564c0-71.926-15.437-155.074-17.437-253.074s30-185,31.087-217s-31.087-46-31.087-26s33,10,31-32s-31-110-31-144S39.582,0,39.582,0",path4:"M39.582,739.564c0-113.074-5.437-166.074-8.437-198.074s36-20.667,33.019-2c-1.796,11.248-24.583,13.333-23.699-22c1.229-49.158,22.68-111,23.68-169s-38-95-46-181S39.582,0,39.582,0"},kl=e=>{let{openedByUser:t,closeScoreboard:o,playerAnimation:l}=e;const a=R(),c=Je(),i=ve(),[d,u]=r.useState(!1),m=()=>{u(!0)},h=Sl();return s("div",{className:"score-board-container",children:[t&&n("div",{className:"cross",onClick:o,children:"X"}),!i&&!c&&n("div",{className:"action-container",children:n("button",{className:"score-board-action",onClick:()=>{m()},children:"Commencer à jouer"})}),n(qe,{className:"win-treasure-img",src:bl,alt:"win-treasure",width:"230",height:"150"}),n("div",{className:"users-path",children:a.map((e=>n(xl,{player:e,openedByUser:t,pathCoordinates:Nl[`path${e.id}`],score:e.score,character:e.character,openStartPlayerRoundDialog:m,isCurrentPlayer:c&&e.id===c.id,playerAnimation:l},e.id)))}),n(vl,{dialogIsOpen:d,closeDialog:()=>{u(!1)},player:h})]})},Sl=()=>{const e=Je(),t=R();let r;if(e){const n=t.findIndex((t=>t.id===e.id));r=n===t.length-1?t[0]:t[n+1]}else r=t[0];return r},xl=e=>{let{pathCoordinates:t,player:o,openedByUser:l,character:a,score:c,openStartPlayerRoundDialog:i,playerAnimation:d}=e;const u=r.useRef(null),m=r.useRef(null),h=r.useRef(null),f=r.useRef(null),p=Sl(),[g,v]=r.useState(null),[b,y]=r.useState([]),[C,N]=r.useState(!1);return r.useEffect((()=>{d&&d.player===o?"user-collect"===d.roundOverReason?(v(d.score),y(d.symbolsInChest)):"3-skulls"===d.roundOverReason?N(!0):"chalenge-failed"===d.roundOverReason&&v(d.score):v(null)}),[d,o]),r.useEffect((()=>{if(!g)return;const{from:e,to:t}=g,r=m.current.animate([{offsetDistance:Dl(e/Cl)},{offsetDistance:Dl(t/Cl)}],{duration:1e3,fill:"forwards"}),n=f.current;let o=null;n&&(o=n.animate([{offsetDistance:Dl(e/Cl)},{offsetDistance:Dl(t/Cl)}],{duration:1e3,fill:"forwards"}));const l=u.current,s=l.getTotalLength();console.log("from",e),console.log("to",t);const a=l.animate([{strokeDashoffset:wl(e/Cl,s)},{strokeDashoffset:wl(t/Cl,s)}],{duration:1e3,fill:"forwards"});return a.onfinish=()=>{"finished"===r.playState&&v(null)},r.onfinish=()=>{"finished"===a.playState&&v(null)},()=>{a.cancel(),r.cancel(),o&&o.cancel()}}),[g]),r.useEffect((()=>{const e=u.current,t=e.getTotalLength();e.style.strokeDasharray=t,e.style.strokeDashoffset=wl(c/Cl,t)}),[c]),s("div",{className:"user-path",children:[s("svg",{viewBox:"0 0 79.164 739.564",width:"50",height:"450",fill:"none",stroke:"none",children:[n("path",{d:t,className:"path-background"}),n("path",{ref:u,d:t,className:"path-foreground"}),s("g",{className:"score-indicator",children:[n("image",{ref:m,href:yl,width:"26",height:"26",className:"boat",style:{offsetPath:`path('${t}')`,offsetDistance:Dl(c/Cl)}}),b&&b.length>0&&n("g",{className:"animation-symbols",ref:f,style:{offsetPath:`path('${t}')`,offsetDistance:Dl(c/Cl)},children:b.map(((e,t)=>n("image",{width:"30",height:"30",className:`symbol symbol-${t+1}`,href:re(e)},t)))})]})]}),n("div",{className:"speech-bubble",children:c}),s("div",{className:"user-avatar "+(p.character.id!==a.id||l?"":"next-player"),onClick:()=>{p.character.id!==a.id||l||i()},children:[C&&n("div",{className:"animation-3skulls",ref:h,children:n(Rl,{})}),n(Al,{character:a})]})]})},Dl=e=>100*e+"%",wl=(e,t)=>t-e*t,Rl=()=>new Array(3).fill("").map(((e,t)=>n(qe,{width:"30",height:"30",className:`skull skull-${t+1}`,src:ue,animateLoaded:!1},t))),Al=e=>{let{character:t}=e;return n(qe,{className:"player-img",src:t.img,alt:"player",width:"40",height:"40",style:{boxShadow:`inset 0px 0px 0px 4px ${t.color||"black"}`}})},Il=()=>{const e=Ol();return s("div",{className:"game-configuration",children:[n("div",{className:"background-image"}),s("div",{className:"content",children:[n("div",{className:"title",children:"A l’abordage !"}),n("div",{className:"subtitle",children:"Combien de joueurs participent à l’aventure ?"}),n("div",{className:"buttons",children:[1,2,3,4,5].map((t=>n("button",{onClick:()=>{e(t)},children:t},t)))})]})]})},Ol=f(((e,t)=>o(o({},e),{},{players:new Array(t).fill("").map(((e,t)=>({id:t+1,number:t+1,score:0})))}))),El=String(new URL(__v__("/mille-sabords/other/Luffy.png"),t.meta.url)),Ll=String(new URL(__v__("/mille-sabords/other/miss_fortune.png"),t.meta.url)),Ml=String(new URL(__v__("/mille-sabords/other/JackSparrow.png"),t.meta.url)),Pl=String(new URL(__v__("/mille-sabords/other/BarbeRouge.png"),t.meta.url)),ql=String(new URL(__v__("/mille-sabords/other/GinetteBoulette.png"),t.meta.url)),Tl=String(new URL(__v__("/mille-sabords/other/CapitaineCrochet.png"),t.meta.url)),jl=[{id:1,name:"Luffy",color:"#ef9620",img:El},{id:2,name:"Miss Fortune",color:"#d90f1b",img:Ll},{id:3,name:"Jack Sparrow",color:"#007033",img:Ml},{id:4,name:"Barbe Rouge",color:"#7baac9",img:Pl},{id:5,name:"Ginette Boulette",color:"#e2500c",img:ql},{id:6,name:"Capitaine Crochet",color:"#952460",img:Tl}],Ul=e=>{let{players:t}=e;const o=Gl(),l=$l(),a=t.find((e=>!e.character));return _l(),r.useEffect((()=>{_l()}),[]),s("div",{className:"character-selection-page",children:[n(Bl,{}),a&&s(c,{children:[s("p",{children:["Joueur ",a.number," : quel pirate êtes vous ?"]}),s("div",{className:"characters-container",id:"menu-wrapper",children:[n("div",{className:"characters menu",children:jl.map((e=>s("div",{className:"character item "+(Fl(e,t)?"":"disabled"),onClick:r=>{Fl(e,t)&&(r.target.animate([{transform:"scale(1)"},{transform:"scale(1.3)"},{transform:"scale(1)"}],{duration:400,fill:"forwards"}),o(a,e))},children:[n(qe,{className:"character-img",width:"40",height:"40",src:e&&e.img,alt:"player",style:{border:`4px solid ${e&&e.color||"black"}`}}),n("span",{children:e.name})]},e.id)))}),s("div",{className:"paddles",children:[n("button",{className:"left-paddle paddle hidden",children:"<"}),n("button",{className:"right-paddle paddle",onClick:()=>{_l()},children:">"})]})]})]}),!a&&s("div",{className:"crew-completed",children:[n("p",{children:"L’équipage est au complet !"}),n(qe,{style:{opacity:.5},src:ie({type:be})}),n("button",{onClick:()=>{l()},children:"Démarrer la partie"})]})]})},Bl=()=>{const e=R();return s("div",{className:"crew "+(e.length>3?"large-crew":""),children:[n("div",{className:"title",children:"Votre equipage:"}),n("ul",{children:e.map((e=>s("li",{children:[e.character?n(qe,{className:"crew-member-img",width:"40px",height:"40px",src:e.character&&e.character.img,alt:"player",style:{border:`4px solid ${e.character&&e.character.color||"black"}`},loadWhenIntersecting:!1}):n("div",{className:"placeholder-img"}),n("span",{children:e.character?e.character.name:`Joueur${e.number}`})]},e.id)))})]})},$l=f((e=>{const{cardIds:t}=e;return o(o({},e),{},{gameStarted:!0,cardIds:Y(t)})})),Fl=(e,t)=>!t.some((t=>t.character&&t.character.name===e.name)),Gl=f(((e,t,r)=>{const{players:n}=e;return t.character=r,o(o({},e),{},{players:[...n]})})),_l=()=>{var e=document.getElementsByClassName("item").length,t=function(){return document.getElementById("menu-wrapper")?document.getElementById("menu-wrapper").offsetWidth:null},r=t(),n=123*e;window.onresize=()=>{r=t()};var o=n-r,l=document.querySelector(".left-paddle"),s=document.querySelector(".right-paddle");document.querySelector(".menu")&&(document.querySelector(".menu").onscroll=()=>{o=n-r;var e=document.querySelector(".menu").scrollLeft,t=o;e<=0?(l.classList.add("hidden"),s.classList.remove("hidden")):e<t?(l.classList.remove("hidden"),s.classList.remove("hidden")):e>=t&&(l.classList.remove("hidden"),s.classList.add("hidden"))}),s&&(s.onclick=()=>{if(document.querySelector(".menu")){const e=document.querySelector(".menu").scrollLeft,t=e+r;Kt({duration:300,onProgress:r=>{let{progress:n}=r;document.querySelector(".menu").scrollLeft=e+(t-e)*n}})}}),l&&(l.onclick=()=>{if(document.querySelector(".menu")){const e=document.querySelector(".menu").scrollLeft,t=e-r;Kt({duration:300,onProgress:r=>{let{progress:n}=r;document.querySelector(".menu").scrollLeft=e+(t-e)*n}})}})},zl=e=>{let{playerAnimationListener:t}=e;const o=R(),l=w(),s=ve(),a=Wl(),c=Yl(),[i,d]=r.useState(!1),[u,m]=r.useState(null),[h,f]=r.useState(null),p=!s||i,g=o.find((e=>e.id===l)),v=r.useRef(null);return r.useEffect((()=>{f(u?{player:g,score:{from:v.current,to:g.score},roundOverReason:u.reason,symbolsInChest:u.symbolsInChest}:null)}),[u,l]),r.useEffect((()=>{if(t)return t(f)}),[t]),a?n(Il,{}):c?n(Ul,{players:o}):p?n(kl,{openedByUser:i,closeScoreboard:()=>{d(!1)},playerAnimation:h}):n(pl,{openScoreboard:()=>{d(!0)},onRoundStart:()=>{v.current=g.score,m(null)},onRoundOver:e=>{m(e)}})},Wl=()=>0===R().length,Yl=()=>!ye(),Hl=f((e=>o(o({},e),{},{animationsDisabled:!0}))),Kl=f((e=>o(o({},e),{},{animationsDisabled:!1}))),Vl=f((e=>o(o({},e),{},{soundDisabled:!0}))),Zl=f((e=>o(o({},e),{},{soundDisabled:!1}))),Xl=f((()=>Ce)),Jl=()=>[Ql(),es()],Ql=()=>{const[e,t]=r.useState(d.availableRef.current);return r.useEffect((()=>d.availableRef.subscribe((()=>{t(d.availableRef.current)}))),[]),e},es=()=>r.useCallback(d.prompt),ts=e=>{let{settingsDialogIsOpen:t}=e;return Ne?n(rs,{settingsDialogIsOpen:t}):null},rs=e=>{let{checkOnOpen:t=!0,settingsDialogIsOpen:o}=e;const[l,a]=r.useState(Ne.state.update);return r.useEffect((()=>Ne.subscribe((()=>{a(Ne.state.update)}))),[]),r.useEffect((()=>{t&&o&&Ne.checkForUpdates()}),[t,o]),s("fieldset",{style:{minHeight:"4em"},children:[n("legend",{children:"Mise a jour"}),l.readyState?n(ns,{update:l}):n(os,{})]})},ns=e=>{let{update:t}=e;const{readyState:r,reloadRequired:o}=t;return s(c,{children:[s("p",{children:["installing"===r?"Mise a jour...":null,"installed"===r?"Mise a jour prête":null,"activating"===r?"Activation de la mise a jour...":null,"activated"===r?"Mise a jour activée, la page va se recharger":null]}),n("button",{disabled:!r,onClick:()=>{Ne.activateUpdate()},children:o?"Recharger pour mettre a jour":"Mettre a jour"})]})},os=()=>{const[e,t]=r.useState(""),o=r.useCallback((async()=>{t("fetching");try{await Ne.checkForUpdates()||t("notfound")}catch(e){t("failed"),console.error(e)}}),[]);return s(c,{children:[s("p",{children:["fetching"===e?"Recherche de mise a jour...":null,"notfound"===e?"Pas de mise a jour disponible.":null,"failed"===e?"Une erreur est survenue.":null]}),n("button",{disabled:"fetching"===e,onClick:o,children:"Chercher"})]})},ls=new URL(__v__("/mille-sabords/css/settings.css"),t.meta.url),ss=()=>{const[e,t,r]=zr();return s(c,{children:[n(er,{href:ls}),n("div",{id:"settings",onClick:()=>{t()},children:n("svg",{className:"settings-icon",width:"24px",height:"24px",viewBox:"0 0 24 24",children:n("path",{fill:"currentColor",d:"M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"})})}),n(as,{settingsDialogIsOpen:e,closeSettingsDialog:r})]})},as=e=>{let{settingsDialogIsOpen:t,closeSettingsDialog:o}=e;const l=z(),a=Hl(),c=Kl(),i=ke(),d=Vl(),u=Zl(),m=Xl(),[h,f]=r.useState(!1),p=()=>{f(!0)};return n(_r,{className:"settings-dialog dialog-spacing-10 dialog-spacing-fluid dialog-spacing-left-fixed dialog-spacing-right-fixed",isOpen:t,onRequestClose:o,requestCloseOnClickOutside:!0,children:s("div",{className:"settings-dialog-content",children:[n("div",{className:"dialog-close",onClick:o,children:n(Hr,{})}),n("div",{className:"dialog-simple-title",children:"Settings"}),n("div",{className:"setting-element",children:s("label",{children:[n("input",{type:"checkbox",className:l?"checked":"unchecked",checked:l,onChange:e=>{e.target.checked?a():c()}}),l&&n(is,{}),"Désactiver les animations"]})}),n("div",{className:"setting-element",children:s("label",{children:[n("input",{type:"checkbox",className:i?"checked":"unchecked",checked:i,onChange:e=>{e.target.checked?d():u()}}),i&&n(is,{}),"Couper le son"]})}),n("div",{className:"setting-element",children:n("button",{onClick:()=>{p()},children:"Annuler la partie"})}),n(cs,{}),n(ts,{settingsDialogIsOpen:t}),n(ds,{confirmCancelGameDialogIsOpen:h,closeConfirmCancelGameDialog:()=>{f(!1)},performCancelGame:()=>{m(),o()}})]})})},cs=()=>{const[e,t]=Jl();return e?n("button",{onClick:()=>{t()},children:"Installer application"}):null},is=()=>n("svg",{className:"check-icon",width:"20",height:"20",viewBox:"0 0 512 512",children:n("path",{fill:"currentColor",d:"M435.848 83.466L172.804 346.51l-96.652-96.652c-4.686-4.686-12.284-4.686-16.971 0l-28.284 28.284c-4.686 4.686-4.686 12.284 0 16.971l133.421 133.421c4.686 4.686 12.284 4.686 16.971 0l299.813-299.813c4.686-4.686 4.686-12.284 0-16.971l-28.284-28.284c-4.686-4.686-12.284-4.686-16.97 0z"})}),ds=e=>{let{confirmCancelGameDialogIsOpen:t,closeConfirmCancelGameDialog:r,performCancelGame:o}=e;return n(_r,{className:"confirm-cancel-game-dialog dialog-spacing-10 dialog-spacing-fluid dialog-spacing-left-fixed dialog-spacing-right-fixed",isOpen:t,onRequestClose:r,requestCloseOnClickOutside:!0,children:s("div",{className:"settings-dialog-content",children:[n("div",{className:"dialog-close",onClick:r,children:n(Hr,{})}),s("div",{className:"title-container",children:[n(qe,{className:"illustration",src:Se,width:"40",height:"40"}),n("div",{className:"title",children:"Êtes-vous certain de vouloir annuler la partie ?"})]}),n("div",{className:"content",children:"Cette action irréversible effacera la progression actuelle et remettra la partie à zéro !"}),n("div",{className:"confirm-action",children:n("button",{onClick:()=>{o(),r()},children:"Confirmer"})})]})})},e("App",(e=>s("div",{id:"main",ref:xe(),children:[n(ss,{}),n(us,o({},e))]}))),us=e=>{const t=De();return n(t?zl:$e,o({},e))}}}}));